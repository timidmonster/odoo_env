
/* /web_editor/static/lib/nearest/jquery.nearest.js defined in bundle 'web_editor.editor' */
;(function($,undefined){var rPerc=/^([\d.]+)%$/;function nearest(selector,options,thisObj){selector||(selector='div');var $container=$(options.container),containerOffset=$container.offset()||{left:0,top:0},containerDims=[containerOffset.left+$container.width(),containerOffset.top+$container.height()],percProps={x:0,y:1,w:0,h:1},prop,match;for(prop in percProps)if(percProps.hasOwnProperty(prop)){match=rPerc.exec(options[prop]);if(match){options[prop]=containerDims[percProps[prop]]*match[1]/100;}}
var $all=$(selector),cache=[],furthest=!!options.furthest,checkX=!!options.checkHoriz,checkY=!!options.checkVert,compDist=furthest?0:Infinity,point1x=parseFloat(options.x)||0,point1y=parseFloat(options.y)||0,point2x=parseFloat(point1x+options.w)||point1x,point2y=parseFloat(point1y+options.h)||point1y,tolerance=options.tolerance||0,hasEach2=!!$.fn.each2,min=Math.min,max=Math.max;if(!options.includeSelf&&thisObj){$all=$all.not(thisObj);}
if(tolerance<0){tolerance=0;}
$all[hasEach2?'each2':'each'](function(i,elem){var $this=hasEach2?elem:$(this),off=$this.offset(),x=off.left,y=off.top,w=$this.outerWidth(),h=$this.outerHeight(),x2=x+w,y2=y+h,maxX1=max(x,point1x),minX2=min(x2,point2x),maxY1=max(y,point1y),minY2=min(y2,point2y),intersectX=minX2>=maxX1,intersectY=minY2>=maxY1,distX,distY,distT,isValid;if((checkX&&checkY)||(!checkX&&!checkY&&intersectX&&intersectY)||(checkX&&intersectY)||(checkY&&intersectX)){distX=intersectX?0:maxX1-minX2;distY=intersectY?0:maxY1-minY2;distT=intersectX||intersectY?max(distX,distY):Math.sqrt(distX*distX+distY*distY);isValid=furthest?distT>=compDist-tolerance:distT<=compDist+tolerance;if(isValid){compDist=furthest?max(compDist,distT):min(compDist,distT);cache.push({node:this,dist:distT});}}});var len=cache.length,filtered=[],compMin,compMax,i,item;if(len){if(furthest){compMin=compDist-tolerance;compMax=compDist;}else{compMin=compDist;compMax=compDist+tolerance;}
for(i=0;i<len;i++){item=cache[i];if(item.dist>=compMin&&item.dist<=compMax){filtered.push(item.node);}}}
return filtered;}
$.each(['nearest','furthest','touching'],function(i,name){var defaults={x:0,y:0,w:0,h:0,tolerance:1,container:document,furthest:name=='furthest',includeSelf:false,checkHoriz:name!='touching',checkVert:name!='touching'};$[name]=function(point,selector,options){if(!point||point.x===undefined||point.y===undefined){return $([]);}
var opts=$.extend({},defaults,point,options||{});return $(nearest(selector,opts));};$.fn[name]=function(selector,options){var opts;if(selector&&$.isPlainObject(selector)){opts=$.extend({},defaults,selector,options||{});return this.pushStack(nearest(this,opts));}
var offset=this.offset(),dimensions={x:offset.left,y:offset.top,w:this.outerWidth(),h:this.outerHeight()};opts=$.extend({},defaults,dimensions,options||{});return this.pushStack(nearest(selector,opts,this));};});})(jQuery);;

/* /web_editor/static/src/js/editor.js defined in bundle 'web_editor.editor' */
odoo.define('web_editor.editor',function(require){"use strict";var ajax=require('web.ajax');var Widget=require('web.Widget');var core=require('web.core');var base=require('web_editor.base');var rte=require('web_editor.rte');var qweb=core.qweb;var _t=core._t;var editor={};editor.dummy=function(){return true;};editor.editable=!!$('html').data('editable');ajax.loadXML('/web_editor/static/src/xml/editor.xml',qweb);$(document).on('click','.note-editable',function(ev){ev.preventDefault();});$(document).on('submit','.note-editable form .btn',function(ev){ev.preventDefault();});$(document).on('hide.bs.dropdown','.dropdown',function(ev){if(ev.originalEvent&&$(ev.target).has(ev.originalEvent.target).length&&$(ev.originalEvent.target).is('[contenteditable]')){ev.preventDefault();}});editor.reload=function(){location.hash="scrollTop="+window.document.body.scrollTop;if(location.search.indexOf("enable_editor")>-1){window.location.href=window.location.href.replace(/&?enable_editor(=[^&]*)?/g,'');}else{window.location.reload(true);}};base.ready().then(function(){if(editor.editable&&location.search.indexOf("enable_editor")>=0){editor.editor_bar=new editor.Class();editor.editor_bar.prependTo(document.body);}});editor.Class=Widget.extend({template:'web_editor.editorbar',events:{'click button[data-action=save]':'save','click a[data-action=cancel]':'cancel',},init:function(parent){var self=this;var res=this._super.apply(this,arguments);this.parent=parent;this.rte=new rte.Class(this);this.rte.on('rte:start',this,function(){self.trigger('rte:start');});return res;},start:function(){var self=this;$('.dropdown-toggle').dropdown();this.display_placeholder();this.rte.on('change',this,this.proxy('rte_changed'));this.rte.start();var flag=false;window.onbeforeunload=function(event){if(rte.history.getEditableHasUndo().length&&!flag){flag=true;setTimeout(function(){flag=false;},0);return _t('This document is not saved!');}};this.$('button[data-action="save"]').prop('disabled',true);return this._super();},display_placeholder:function(){var $area=$("#wrapwrap").find("[data-oe-model] .oe_structure.oe_empty, [data-oe-model].oe_structure.oe_empty, [data-oe-type=html]").filter(".oe_not_editable").filter(".oe_no_empty");this.on('rte:start',this,function(){$area.attr("data-oe-placeholder",_t("Write Your Text Here"));});this.on("snippets:ready",this,function(){if($("body").hasClass("editor_has_snippets")){$area.attr("data-oe-placeholder",_t("Write Your Text or Drag a Block Here"));}});$(document).on("keyup",function(event){if((event.keyCode===8||event.keyCode===46)){var $target=$(event.target).closest(".o_editable");if(!$target.is(":has(*:not(p):not(br))")&&!$target.text().match(/\S/)){$target.empty();}}});},rte_changed:function(){this.$('button[data-action=save]').prop('disabled',!rte.history.getEditableHasUndo().length);},save:function(){return this.rte.save().then(function(){editor.reload();});},save_without_reload:function(){return this.rte.save();},cancel:function(){new $.Deferred(function(d){if(!rte.history.getEditableHasUndo().length){return d.resolve();}
var $dialog=$(qweb.render('web_editor.discard')).appendTo(document.body);$dialog.on('click','.btn-danger',function(){d.resolve();}).on('hidden.bs.modal',function(){d.reject();}).on('keydown.dismiss.bs.modal',function(event){event.stopImmediatePropagation();});d.always(function(){$dialog.remove();});$dialog.modal('show');}).then(function(){window.onbeforeunload=null;editor.reload();});},});return editor;});;

/* /web_editor/static/src/js/rte.js defined in bundle 'web_editor.editor' */
odoo.d;

/* /web_editor/static/src/js/rte.summernote.js defined in bundle 'web_editor.editor' */
odoo.define('web_editor.rte.summernote',function(require){'use strict';var core=require('web.core');var ajax=require('web.ajax');var base=require('web_editor.base');var widgets=require('web_editor.widget');var rte=require('web_editor.rte');var QWeb=core.qweb;var _t=core._t;ajax.jsonRpc('/web/dataset/call','call',{'model':'ir.ui.view','method':'read_template','args':['web_editor.colorpicker',base.get_context()]}).done(function(data){QWeb.add_template(data);});var dom=$.summernote.core.dom;var range=$.summernote.core.range;var eventHandler=$.summernote.eventHandler;var renderer=$.summernote.renderer;var options=$.summernote.options;var tplButton=renderer.getTemplate().button;var tplIconButton=renderer.getTemplate().iconButton;var tplDropdown=renderer.getTemplate().dropdown;var fn_createPalette=renderer.createPalette;renderer.createPalette=function($container,options){fn_createPalette.call(this,$container,options);if(!QWeb.has_template('web_editor.colorpicker')){return;}
var $color=$container.find('.note-color');var html=QWeb.render('web_editor.colorpicker');$color.find('.note-color-palette').prepend(html);var $bg=$color.find('.colorpicker:first button');var $fore=$color.find('.colorpicker:last button');$bg.each(function(){$(this).attr('data-event','backColor').attr('data-value',$(this).attr('class'));});$fore.each(function(){$(this).attr('data-event','foreColor').attr('data-value',$(this).attr('class').replace(/bg-/,'text-'));});};var fn_tplPopovers=renderer.tplPopovers;renderer.tplPopovers=function(lang,options){var $popover=$(fn_tplPopovers.call(this,lang,options));var $imagePopover=$popover.find('.note-image-popover');var $linkPopover=$popover.find('.note-link-popover');var $airPopover=$popover.find('.note-air-popover');if(window===window.top){$popover.children().addClass("hidden-xs");}
var $centerbutton=$(tplIconButton('fa fa-align-center',{title:_t('Center'),event:'floatMe',value:'center'})).insertAfter($imagePopover.find('[data-event="floatMe"][data-value="left"]'));$imagePopover.find('button[data-event="removeMedia"]').parent().remove();$imagePopover.find('button[data-event="floatMe"][data-value="none"]').remove();var $alt=$('<div class="btn-group"/>');$alt.prependTo($imagePopover.find('.popover-content'));$alt.append('<button class="btn btn-default btn-sm btn-small" data-event="alt"><strong>Alt: </strong><span class="o_image_alt"></span></button>');var $padding=$('<div class="btn-group"/>');$padding.insertBefore($imagePopover.find('.btn-group:first'));var dropdown_content=['<li><a data-event="padding" href="#" data-value="">'+_t('None')+'</a></li>','<li><a data-event="padding" href="#" data-value="small">'+_t('Small')+'</a></li>','<li><a data-event="padding" href="#" data-value="medium">'+_t('Medium')+'</a></li>','<li><a data-event="padding" href="#" data-value="large">'+_t('Large')+'</a></li>','<li><a data-event="padding" href="#" data-value="xl">'+_t('Xl')+'</a></li>',];var $button=$(tplIconButton('fa fa-plus-square-o',{title:_t('Padding'),dropdown:tplDropdown(dropdown_content)})).appendTo($padding);$imagePopover.find('[data-event="imageShape"]:not([data-value])').remove();var $button=$(tplIconButton('fa fa-sun-o',{title:_t('Shadow'),event:'imageShape',value:'shadow'})).insertAfter($imagePopover.find('[data-event="imageShape"][data-value="img-circle"]'));var $spin=$('<div class="btn-group hidden only_fa"/>').insertAfter($button.parent());$(tplIconButton('fa fa-refresh',{title:_t('Spin'),event:'imageShape',value:'fa-spin'})).appendTo($spin);var $resizefa=$('<div class="btn-group hidden only_fa"/>').insertAfter($imagePopover.find('.btn-group:has([data-event="resize"])'));for(var size=1;size<=5;size++){$(tplButton('<span class="note-fontsize-10">'+size+'x</span>',{title:size+"x",event:'resizefa',value:size+''})).appendTo($resizefa);}
var $colorfa=$airPopover.find('.note-color').clone();$colorfa.find(".btn-group:first").remove();$colorfa.find("ul.dropdown-menu").css('min-width','172px');$colorfa.find('button[data-event="color"]').attr('data-value','{"foreColor": "#f00"}').find("i").css({'background':'','color':'#f00'});$resizefa.after($colorfa);var $imageprop=$('<div class="btn-group"/>');$imageprop.appendTo($imagePopover.find('.popover-content'));$(tplIconButton('fa fa-picture-o',{title:_t('Edit'),event:'showImageDialog'})).appendTo($imageprop);$(tplIconButton('fa fa-trash-o',{title:_t('Remove'),event:'delete'})).appendTo($imageprop);$imagePopover.find('.popover-content').append($airPopover.find(".note-history").clone());$imagePopover.find('[data-event="showImageDialog"]').before($airPopover.find('[data-event="showLinkDialog"]').clone());$linkPopover.find('.popover-content').append($airPopover.find(".note-history").clone());$linkPopover.find('button[data-event="showLinkDialog"] i').attr("class","fa fa-link");$linkPopover.find('button[data-event="unlink"]').before($airPopover.find('button[data-event="showImageDialog"]').clone());$airPopover.find('.note-style').on('mousedown',function(){var $format=$airPopover.find('[data-event="formatBlock"]');var node=range.create().sc;var formats=$format.map(function(){return $(this).data("value");}).get();while(node&&(!node.tagName||(!node.tagName||formats.indexOf(node.tagName.toLowerCase())===-1))){node=node.parentNode;}
$format.parent().removeClass('active');$format.filter('[data-value="'+(node?node.tagName.toLowerCase():"p")+'"]').parent().addClass("active");});setTimeout(function(){$airPopover.add($linkPopover).add($imagePopover).find("button").tooltip('destroy').tooltip({container:'body',trigger:'hover',placement:'bottom'}).on('click',function(){$(this).tooltip('hide');});});return $popover;};var fn_boutton_update=eventHandler.modules.popover.button.update;eventHandler.modules.popover.button.update=function($container,oStyle){var previous=$(".note-control-selection").data('target');if(previous){$(previous).css({"-webkit-animation-play-state":"","animation-play-state":"","-webkit-transition":"","transition":"","-webkit-animation":"","animation":""});}
if(oStyle.image){$(oStyle.image).css({"-webkit-animation":"none","animation":"none"});}
fn_boutton_update.call(this,$container,oStyle);$container.find('.note-color').removeClass("hidden");if(oStyle.image){$container.find('[data-event]').parent().removeClass("active");$container.find('a[data-event="padding"][data-value="small"]').parent().toggleClass("active",$(oStyle.image).hasClass("padding-small"));$container.find('a[data-event="padding"][data-value="medium"]').parent().toggleClass("active",$(oStyle.image).hasClass("padding-medium"));$container.find('a[data-event="padding"][data-value="large"]').parent().toggleClass("active",$(oStyle.image).hasClass("padding-large"));$container.find('a[data-event="padding"][data-value="xl"]').parent().toggleClass("active",$(oStyle.image).hasClass("padding-xl"));$container.find('a[data-event="padding"][data-value=""]').parent().toggleClass("active",!$container.find('.active a[data-event="padding"]').length);if(dom.isImgFont(oStyle.image)){$container.find('.btn-group:not(.only_fa):has(button[data-event="resize"],button[data-value="img-thumbnail"])').addClass("hidden");$container.find('.only_fa').removeClass("hidden");$container.find('button[data-event="resizefa"][data-value="2"]').toggleClass("active",$(oStyle.image).hasClass("fa-2x"));$container.find('button[data-event="resizefa"][data-value="3"]').toggleClass("active",$(oStyle.image).hasClass("fa-3x"));$container.find('button[data-event="resizefa"][data-value="4"]').toggleClass("active",$(oStyle.image).hasClass("fa-4x"));$container.find('button[data-event="resizefa"][data-value="5"]').toggleClass("active",$(oStyle.image).hasClass("fa-5x"));$container.find('button[data-event="resizefa"][data-value="1"]').toggleClass("active",!$container.find('.active[data-event="resizefa"]').length);$container.find('button[data-event="imageShape"][data-value="fa-spin"]').toggleClass("active",$(oStyle.image).hasClass("fa-spin"));$container.find('button[data-event="imageShape"][data-value="shadow"]').toggleClass("active",$(oStyle.image).hasClass("shadow"));}else{$container.find('.hidden:not(.only_fa)').removeClass("hidden");$container.find('.only_fa').addClass("hidden");var width=($(oStyle.image).attr('style')||'').match(/(^|;|\s)width:\s*([0-9]+%)/);if(width){width=width[2];}
$container.find('button[data-event="resize"][data-value="1"]').toggleClass("active",width==="100%");$container.find('button[data-event="resize"][data-value="0.5"]').toggleClass("active",width==="50%");$container.find('button[data-event="resize"][data-value="0.25"]').toggleClass("active",width==="25%");$container.find('button[data-event="imageShape"][data-value="shadow"]').toggleClass("active",$(oStyle.image).hasClass("shadow"));if(!$(oStyle.image).is("img")){$container.find('.btn-group:has(button[data-event="imageShape"])').addClass("hidden");}
$container.find('.note-color').addClass("hidden");}
$container.find('button[data-event="floatMe"][data-value="left"]').toggleClass("active",$(oStyle.image).hasClass("pull-left"));$container.find('button[data-event="floatMe"][data-value="center"]').toggleClass("active",$(oStyle.image).hasClass("center-block"));$container.find('button[data-event="floatMe"][data-value="right"]').toggleClass("active",$(oStyle.image).hasClass("pull-right"));$(oStyle.image).trigger('attributes_change');}};var fn_popover_update=eventHandler.modules.popover.update;eventHandler.modules.popover.update=function($popover,oStyle,isAirMode){var $imagePopover=$popover.find('.note-image-popover');var $linkPopover=$popover.find('.note-link-popover');var $airPopover=$popover.find('.note-air-popover');fn_popover_update.call(this,$popover,oStyle,isAirMode);if(oStyle.image){if(oStyle.image.parentNode.className.match(/(^|\s)media_iframe_video(\s|$)/i)){oStyle.image=oStyle.image.parentNode;}
var alt=$(oStyle.image).attr("alt");$imagePopover.find('.o_image_alt').text((alt||"").replace(/&quot;/g,'"')).parent().toggle(oStyle.image.tagName==="IMG");$imagePopover.show();range.createFromNode(dom.firstChild(oStyle.image)).select();}else{$(".note-control-selection").hide();}
if(oStyle.image||(oStyle.range&&(!oStyle.range.isCollapsed()||(oStyle.range.sc.tagName&&!dom.isAnchor(oStyle.range.sc))))||(oStyle.image&&!$(oStyle.image).closest('a').length)){$linkPopover.hide();oStyle.anchor=false;}
if(oStyle.image||oStyle.anchor||(oStyle.range&&!$(oStyle.range.sc).closest('.note-editable').length)){$airPopover.hide();}else{$airPopover.show();}};var fn_handle_update=eventHandler.modules.handle.update;eventHandler.modules.handle.update=function($handle,oStyle,isAirMode){fn_handle_update.call(this,$handle,oStyle,isAirMode);if(oStyle.image){$handle.find('.note-control-selection').hide();}};function getImgTarget($editable){var $handle=$editable?dom.makeLayoutInfo($editable).handle():undefined;return $(".note-control-selection",$handle).data('target');}
eventHandler.modules.editor.padding=function($editable,sValue){var $target=$(getImgTarget($editable));var paddings="small medium large xl".split(/\s+/);$editable.data('NoteHistory').recordUndo();if(sValue.length){paddings.splice(paddings.indexOf(sValue),1);$target.toggleClass('padding-'+sValue);}
$target.removeClass("padding-"+paddings.join(" padding-"));};eventHandler.modules.editor.resize=function($editable,sValue){var $target=$(getImgTarget($editable));$editable.data('NoteHistory').recordUndo();var width=($target.attr('style')||'').match(/(^|;|\s)width:\s*([0-9]+)%/);if(width){width=width[2]/100;}
$target.css('width',width!=sValue?(sValue*100)+'%':'');};eventHandler.modules.editor.resizefa=function($editable,sValue){var $target=$(getImgTarget($editable));$editable.data('NoteHistory').recordUndo();$target.attr('class',$target.attr('class').replace(/\s*fa-[0-9]+x/g,''));if(+sValue>1){$target.addClass('fa-'+sValue+'x');}};eventHandler.modules.editor.floatMe=function($editable,sValue){var $target=$(getImgTarget($editable));$editable.data('NoteHistory').recordUndo();switch(sValue){case'center':$target.toggleClass('center-block').removeClass('pull-right pull-left');break;case'left':$target.toggleClass('pull-left').removeClass('pull-right center-block');break;case'right':$target.toggleClass('pull-right').removeClass('pull-left center-block');break;}};eventHandler.modules.editor.imageShape=function($editable,sValue){var $target=$(getImgTarget($editable));$editable.data('NoteHistory').recordUndo();$target.toggleClass(sValue);};eventHandler.modules.linkDialog.showLinkDialog=function($editable,$dialog,linkInfo){$editable.data('range').select();$editable.data('NoteHistory').recordUndo();var editor=new widgets.LinkDialog($editable,linkInfo);editor.appendTo(document.body);var def=new $.Deferred();editor.on("save",this,function(linkInfo){linkInfo.range.select();$editable.data('range',linkInfo.range);def.resolve(linkInfo);$editable.trigger('keyup');$('.note-popover .note-link-popover').show();});editor.on("cancel",this,function(){def.reject();});return def;};eventHandler.modules.imageDialog.showImageDialog=function($editable){var r=$editable.data('range');if(r.sc.tagName&&r.sc.childNodes.length){r.sc=r.sc.childNodes[r.so];}
var editor=new widgets.MediaDialog($editable,dom.isImg(r.sc)?r.sc:null);editor.appendTo(document.body);return new $.Deferred().reject();};$.summernote.pluginEvents.alt=function(event,editor,layoutInfo,sorted){var $editable=layoutInfo.editable();var $selection=layoutInfo.handle().find('.note-control-selection');var media=$selection.data('target');new widgets.alt($editable,media).appendTo(document.body);};var fn_is_void=dom.isVoid;dom.isVoid=function(node){return fn_is_void(node)||dom.isImgFont(node)||(node&&node.className&&node.className.match(/(^|\s)media_iframe_video(\s|$)/i));};dom.isImg=function(node){return dom.isImgFont(node)||(node&&(node.nodeName==="IMG"||(node.className&&node.className.match(/(^|\s)(media_iframe_video|o_image)(\s|$)/i))));};dom.isForbiddenNode=function(node){return $(node).is(".media_iframe_video, .fa, img");};dom.isImgFont=function(node){var nodeName=node&&node.nodeName.toUpperCase();var className=(node&&node.className||"");if(node&&(nodeName==="SPAN"||nodeName==="I")&&className.length){var classNames=className.split(/\s+/);for(var k=0;k<widgets.fontIcons.length;k++){if(_.intersection(widgets.fontIcons[k].alias,classNames).length){return true;}}}
return false;};var isFont=dom.isFont;dom.isFont=function(node){return dom.isImgFont(node)||isFont(node);};var fn_visible=$.summernote.pluginEvents.visible;$.summernote.pluginEvents.visible=function(event,editor,layoutInfo){var res=fn_visible.call(this,event,editor,layoutInfo);var rng=range.create();if(!rng)return res;var $node=$(dom.node(rng.sc));if(($node.is('[data-oe-type="html"]')||$node.is('[data-oe-field="arch"]'))&&$node.hasClass("o_editable")&&!$node[0].children.length&&"h1 h2 h3 h4 h5 h6 p b bold i u code sup strong small pre th td".toUpperCase().indexOf($node[0].nodeName)===-1){var p=$('<p><br/></p>')[0];$node.append(p);range.createFromNode(p.firstChild).select();}
return res;};function prettify_html(html){html=html.trim();var result='',level=0,get_space=function(level){var i=level,space='';while(i--)space+='  ';return space;},reg=/^<\/?(a|span|font|strong|u|i|strong|b)(\s|>)/i,inline_level=Infinity,tokens=_.compact(_.flatten(_.map(html.split(/</),function(value){value=value.replace(/\s+/g,' ').split(/>/);value[0]=/\S/.test(value[0])?'<'+value[0]+'>':'';return value;})));for(var i=0,l=tokens.length;i<l;i++){var token=tokens[i];var inline_tag=reg.test(token);var inline=inline_tag||inline_level<=level;if(token[0]==='<'&&token[1]==='/'){if(inline_tag&&inline_level===level){inline_level=Infinity;}
level--;}
if(!inline&&!/\S/.test(token)){continue;}
if(!inline||(token[1]!=='/'&&inline_level>level)){result+=get_space(level);}
if(token[0]==='<'&&token[1]!=='/'){level++;if(inline_tag&&inline_level>level){inline_level=level;}}
if(token.match(/^<(img|hr|br)/)){level--;}
result+=token.trim().replace(/\s+/,' ');if(inline_level>level){result+='\n';}}
return result;}
$.summernote.pluginEvents.codeview=function(event,editor,layoutInfo,enable){if(layoutInfo===undefined){return;}
if(layoutInfo.toolbar){var is_activated=$.summernote.eventHandler.modules.codeview.isActivated(layoutInfo);if(is_activated===enable){return;}
return eventHandler.modules.codeview.toggle(layoutInfo);}else{var $editor=layoutInfo.editor();var $textarea=$editor.prev('textarea');if($textarea.is('textarea')===enable){return;}
if(!$textarea.length){var html=prettify_html($editor.prop("innerHTML"));$editor.parent().css({'position':'absolute','top':0,'bottom':0,'left':0,'right':0});$textarea=$('<textarea/>').css({'margin':'0 -4px','padding':'0 4px','border':0,'top':'51px','left':'620px','width':'100%','font-family':'sans-serif','font-size':'13px','height':'98%','white-space':'pre','word-wrap':'normal'}).val(html).data('init',html);$editor.before($textarea);$editor.hide();}else{$editor.prop('innerHTML',$textarea.val().replace(/\s*\n\s*/g,'')).trigger('content_changed');$textarea.remove();$editor.show();}}};var initial_data={};function reRangeSelectKey(event){initial_data.range=null;if(event.shiftKey&&event.keyCode>=37&&event.keyCode<=40&&!$(event.target).is("input, textarea, select")){var r=range.create();if(r){var rng=r.reRange(event.keyCode<=38);if(r!==rng){rng.select();}}}}
function reRangeSelect(event,dx,dy){var r=range.create();if(!r||r.isCollapsed())return;var data=r.reRange(dy<0||(dy===0&&dx<0));if(data.sc!==r.sc||data.so!==r.so||data.ec!==r.ec||data.eo!==r.eo){setTimeout(function(){data.select();$(data.sc.parentNode).closest('.note-popover');},0);}
$(data.sc).closest('.o_editable').data('range',r);return r;}
function summernote_mouseup(event){if($(event.target).closest("#web_editor-top-navbar, .note-popover").length){return;}
if(initial_data.event){var dx=event.clientX-(event.shiftKey&&initial_data.rect?initial_data.rect.left:initial_data.event.clientX);var dy=event.clientY-(event.shiftKey&&initial_data.rect?initial_data.rect.top:initial_data.event.clientY);if(10<Math.pow(dx,2)+Math.pow(dy,2)){reRangeSelect(event,dx,dy);}}
if(!$(event.target).closest(".o_editable").length){return;}
if(!initial_data.range||!event.shiftKey){setTimeout(function(){initial_data.range=range.create();},0);}}
var remember_selection;function summernote_mousedown(event){rte.history.splitNext();var $editable=$(event.target).closest(".o_editable, .note-editor");if(!!document.documentMode){summernote_ie_fix(event,function(node){return node.tagName==="DIV"||node.tagName==="IMG"||(node.dataset&&node.dataset.oeModel);});}else if(last_div&&event.target!==last_div){if(last_div.tagName==="A"){summernote_ie_fix(event,function(node){return node.dataset&&node.dataset.oeModel;});}else if($editable.length){if(summernote_ie_fix(event,function(node){return node.tagName==="A";})){var r=range.create();r.select();}}}
var r=range.create();var editables=$(".o_editable[contenteditable], .note-editable[contenteditable]");var r_editable=editables.has((r||{}).sc);if(!r_editable.closest('.note-editor').is($editable)&&!r_editable.filter('.o_editable').is(editables)){var saved_editable=editables.has((remember_selection||{}).sc);if($editable.length&&!saved_editable.closest('.o_editable, .note-editor').is($editable)){remember_selection=range.create(dom.firstChild($editable[0]),0);}else if(!saved_editable.length){remember_selection=undefined;}
if(remember_selection){try{remember_selection.select();}catch(e){console.warn(e);}}}else if(r_editable.length){remember_selection=r;}
initial_data.event=event;if(event.shiftKey&&$editable.length){if(initial_data.range){initial_data.range.select();}
var rect=r&&r.getClientRects();initial_data.rect=rect&&rect.length?rect[0]:{top:0,left:0};}}
var last_div;var last_div_change;var last_editable;function summernote_ie_fix(event,pred){var editable;var div;var node=event.target;while(node.parentNode){if(!div&&pred(node)){div=node;}
if(last_div!==node&&(node.getAttribute('contentEditable')==='false'||node.className&&(node.className.indexOf('o_not_editable')!==-1))){break;}
if(node.className&&node.className.indexOf('o_editable')!==-1){if(!div){div=node;}
editable=node;break;}
node=node.parentNode;}
if(!editable){$(last_div_change).removeAttr("contentEditable").removeProp("contentEditable");$(last_editable).attr("contentEditable","true").prop("contentEditable","true");last_div_change=null;last_editable=null;return;}
if(div===last_div){return;}
last_div=div;$(last_div_change).removeAttr("contentEditable").removeProp("contentEditable");if(last_editable!==editable){if($(editable).is("[contentEditable='true']")){$(editable).removeAttr("contentEditable").removeProp("contentEditable");last_editable=editable;}else{last_editable=null;}}
if(!$(div).attr("contentEditable")&&!$(div).is("[data-oe-type='many2one'], [data-oe-type='contact']")){$(div).attr("contentEditable","true").prop("contentEditable","true");last_div_change=div;}else{last_div_change=null;}
return editable!==div?div:null;}
var fn_attach=eventHandler.attach;eventHandler.attach=function(oLayoutInfo,options){fn_attach.call(this,oLayoutInfo,options);oLayoutInfo.editor().on('dragstart','img',function(e){e.preventDefault();});$(document).on('mousedown',summernote_mousedown);$(document).on('mouseup',summernote_mouseup);oLayoutInfo.editor().off('click').on('click',function(e){e.preventDefault();});oLayoutInfo.editor().on('dblclick','img, .media_iframe_video, span.fa, i.fa, span.fa, a.o_image',function(event){if(!$(event.target).closest(".note-toolbar").length){new widgets.MediaDialog(oLayoutInfo.editor(),event.target).appendTo(document.body);}});if(oLayoutInfo.editor().is('[data-oe-model][data-oe-type="image"]')){oLayoutInfo.editor().on('click','img',function(event){$(event.target).trigger("dblclick");});}
oLayoutInfo.editable().on('mousedown',function(e){if(dom.isImg(e.target)){range.createFromNode(e.target).select();}});$(document).on("keyup",reRangeSelectKey);var clone_data=false;var $node=oLayoutInfo.editor();if($node.data('oe-model')||$node.data('oe-translation-id')){$node.on('content_changed',function(){var $nodes=$('[data-oe-model], [data-oe-translation-id]').filter(function(){return this!=$node[0];});if($node.data('oe-model')){$nodes=$nodes.filter('[data-oe-model="'+$node.data('oe-model')+'"]').filter('[data-oe-id="'+$node.data('oe-id')+'"]').filter('[data-oe-field="'+$node.data('oe-field')+'"]');}
if($node.data('oe-translation-id'))$nodes=$nodes.filter('[data-oe-translation-id="'+$node.data('oe-translation-id')+'"]');if($node.data('oe-type'))$nodes=$nodes.filter('[data-oe-type="'+$node.data('oe-type')+'"]');if($node.data('oe-expression'))$nodes=$nodes.filter('[data-oe-expression="'+$node.data('oe-expression')+'"]');if($node.data('oe-xpath'))$nodes=$nodes.filter('[data-oe-xpath="'+$node.data('oe-xpath')+'"]');if($node.data('oe-contact-options'))$nodes=$nodes.filter('[data-oe-contact-options="'+$node.data('oe-contact-options')+'"]');var nodes=$node.get();if($node.data('oe-type')==="many2one"){$nodes=$nodes.add($('[data-oe-model]').filter(function(){return this!=$node[0]&&nodes.indexOf(this)===-1;}).filter('[data-oe-many2one-model="'+$node.data('oe-many2one-model')+'"]').filter('[data-oe-many2one-id="'+$node.data('oe-many2one-id')+'"]').filter('[data-oe-type="many2one"]'));$nodes=$nodes.add($('[data-oe-model]').filter(function(){return this!=$node[0]&&nodes.indexOf(this)===-1;}).filter('[data-oe-model="'+$node.data('oe-many2one-model')+'"]').filter('[data-oe-id="'+$node.data('oe-many2one-id')+'"]').filter('[data-oe-field="name"]'));}
if(!clone_data){clone_data=true;$nodes.html(this.innerHTML);clone_data=false;}});}
var custom_toolbar=oLayoutInfo.toolbar?oLayoutInfo.toolbar():undefined;var $toolbar=$(oLayoutInfo.popover()).add(custom_toolbar);$('button[data-event="undo"], button[data-event="redo"]',$toolbar).attr('disabled',true);$(oLayoutInfo.editor()).add(oLayoutInfo.handle()).add(oLayoutInfo.popover()).add(custom_toolbar).on('click content_changed',function(){$('button[data-event="undo"]',$toolbar).attr('disabled',!oLayoutInfo.editable().data('NoteHistory').hasUndo());$('button[data-event="redo"]',$toolbar).attr('disabled',!oLayoutInfo.editable().data('NoteHistory').hasRedo());});};var fn_detach=eventHandler.detach;eventHandler.detach=function(oLayoutInfo,options){fn_detach.call(this,oLayoutInfo,options);oLayoutInfo.editable().off('mousedown');oLayoutInfo.editor().off("dragstart");oLayoutInfo.editor().off('click');$(document).off('mousedown',summernote_mousedown);$(document).off('mouseup',summernote_mouseup);oLayoutInfo.editor().off("dblclick");$(document).off("keyup",reRangeSelectKey);};$.summernote.lang.odoo={font:{bold:_t('Bold'),italic:_t('Italic'),underline:_t('Underline'),strikethrough:_t('Strikethrough'),subscript:_t('Subscript'),superscript:_t('Superscript'),clear:_t('Remove Font Style'),height:_t('Line Height'),name:_t('Font Family'),size:_t('Font Size')},image:{image:_t('Picture'),insert:_t('Insert Image'),resizeFull:_t('Resize Full'),resizeHalf:_t('Resize Half'),resizeQuarter:_t('Resize Quarter'),floatLeft:_t('Float Left'),floatRight:_t('Float Right'),floatNone:_t('Float None'),dragImageHere:_t('Drag an image here'),selectFromFiles:_t('Select from files'),url:_t('Image URL'),remove:_t('Remove Image')},link:{link:_t('Link'),insert:_t('Insert Link'),unlink:_t('Unlink'),edit:_t('Edit'),textToDisplay:_t('Text to display'),url:_t('To what URL should this link go?'),openInNewWindow:_t('Open in new window')},video:{video:_t('Video'),videoLink:_t('Video Link'),insert:_t('Insert Video'),url:_t('Video URL?'),providers:_t('(YouTube, Vimeo, Vine, Instagram, DailyMotion or Youku)')},table:{table:_t('Table')},hr:{insert:_t('Insert Horizontal Rule')},style:{style:_t('Style'),normal:_t('Normal'),blockquote:_t('Quote'),pre:_t('Code'),h1:_t('Header 1'),h2:_t('Header 2'),h3:_t('Header 3'),h4:_t('Header 4'),h5:_t('Header 5'),h6:_t('Header 6')},lists:{unordered:_t('Unordered list'),ordered:_t('Ordered list')},options:{help:_t('Help'),fullscreen:_t('Full Screen'),codeview:_t('Code View')},paragraph:{paragraph:_t('Paragraph'),outdent:_t('Outdent'),indent:_t('Indent'),left:_t('Align left'),center:_t('Align center'),right:_t('Align right'),justify:_t('Justify full')},color:{recent:_t('Recent Color'),more:_t('More Color'),background:_t('Background Color'),foreground:_t('Foreground Color'),transparent:_t('Transparent'),setTransparent:_t('Set transparent'),reset:_t('Reset'),resetToDefault:_t('Reset to default')},shortcut:{shortcuts:_t('Keyboard shortcuts'),close:_t('Close'),textFormatting:_t('Text formatting'),action:_t('Action'),paragraphFormatting:_t('Paragraph formatting'),documentStyle:_t('Document Style')},history:{undo:_t('Undo'),redo:_t('Redo')}};});;

/* /web_editor/static/src/js/widgets.js defined in bundle 'web_editor.editor' */
odoo.define('web_editor.widget',function(require){'use strict';var core=require('web.core');var ajax=require('web.ajax');var Widget=require('web.Widget');var base=require('web_editor.base');var rte=require('web_editor.rte');var QWeb=core.qweb;var range=$.summernote.core.range;var dom=$.summernote.core.dom;var Dialog=Widget.extend({events:{'hidden.bs.modal':'destroy','keydown.dismiss.bs.modal':'stop_escape','click button.save':'save','click button[data-dismiss="modal"]':'cancel',},init:function(){this._super();},start:function(){var sup=this._super();this.$el.modal({backdrop:'static'});this.$('input:first').focus();return sup;},save:function(){this.close();this.trigger("saved");},cancel:function(){this.trigger("cancel");},close:function(){this.$el.modal('hide');},destroy:function(){this._super();$("body:has('> .modal:visible')").addClass('modal-open');},stop_escape:function(event){if($(".modal.in").length>0&&event.which==27){event.stopPropagation();}}});var alt=Dialog.extend({template:'web_editor.dialog.alt',init:function($editable,media){this.$editable=$editable;this.media=media;this.alt=($(this.media).attr('alt')||"").replace(/&quot;/g,'"');this.title=($(this.media).attr('title')||"").replace(/&quot;/g,'"');return this._super();},save:function(){var self=this;range.createFromNode(self.media).select();this.$editable.data('NoteHistory').recordUndo();var alt=this.$('#alt').val();var title=this.$('#title').val();$(this.media).attr('alt',alt?alt.replace(/"/g,"&quot;"):null).attr('title',title?title.replace(/"/g,"&quot;"):null);setTimeout(function(){click_event(self.media,"mouseup");},0);return this._super();},});var click_event=function(el,type){var evt=document.createEvent("MouseEvents");evt.initMouseEvent(type,true,true,window,0,0,0,0,0,false,false,false,false,0,el);el.dispatchEvent(evt);};var MediaDialog=Dialog.extend({template:'web_editor.dialog.media',events:_.extend({},Dialog.prototype.events,{'input input#icon-search':'search',}),init:function($editable,media,options){this._super();if($editable){this.$editable=$editable;this.rte=this.$editable.rte||this.$editable.data('rte');}
this.options=options||{};this.old_media=media;this.media=media;this.isNewMedia=!media;this.range=range.create();},start:function(){var self=this;this.only_images=this.options.only_images||this.options.select_images||(this.media&&$(this.media).parent().data("oe-field")==="image");if(this.only_images){this.$('[href="#editor-media-document"], [href="#editor-media-video"], [href="#editor-media-icon"]').addClass('hidden');}
if(this.media){if(this.media.nodeName==="IMG"){this.$('[href="#editor-media-image"]').tab('show');}else if($(this.media).is('a.o_image')){this.$('[href="#editor-media-document"]').tab('show');}else if(this.media.className.match(/(^|\s)media_iframe_video($|\s)/)){this.$('[href="#editor-media-video"]').tab('show');}else if(this.media.parentNode.className.match(/(^|\s)media_iframe_video($|\s)/)){this.media=this.media.parentNode;this.$('[href="#editor-media-video"]').tab('show');}else if(this.media.className.match(/(^|\s)fa($|\s)/)){this.$('[href="#editor-media-icon"]').tab('show');}}
this.imageDialog=new ImageDialog(this,this.media,this.options);this.imageDialog.appendTo(this.$("#editor-media-image"));this.documentDialog=new ImageDialog(this,this.media,_.extend({'document':true},this.options));this.documentDialog.appendTo(this.$("#editor-media-document"));if(!this.only_images){this.iconDialog=new fontIconsDialog(this,this.media,this.options);this.iconDialog.appendTo(this.$("#editor-media-icon"));this.videoDialog=new VideoDialog(this,this.media,this.options);this.videoDialog.appendTo(this.$("#editor-media-video"));}
this.active=this.imageDialog;$('a[data-toggle="tab"]').on('shown.bs.tab',function(event){if($(event.target).is('[href="#editor-media-image"]')){self.active=self.imageDialog;self.$('li.search, li.previous, li.next').removeClass("hidden");}if($(event.target).is('[href="#editor-media-document"]')){self.active=self.documentDialog;self.$('li.search, li.previous, li.next').removeClass("hidden");}else if($(event.target).is('[href="#editor-media-icon"]')){self.active=self.iconDialog;self.$('li.search, li.previous, li.next').removeClass("hidden");self.$('.nav-tabs li.previous, .nav-tabs li.next').addClass("hidden");}else if($(event.target).is('[href="#editor-media-video"]')){self.active=self.videoDialog;self.$('.nav-tabs li.search').addClass("hidden");}});return this._super();},save:function(){if(this.options.select_images){this.trigger("saved",this.active.save());this.close();return;}
if(this.rte){this.range.select();this.rte.historyRecordUndo(this.media);}
var self=this;if(self.media){this.media.innerHTML="";if(this.active!==this.imageDialog&&this.active!==this.documentDialog){this.imageDialog.clear();}
if(this.iconDialog&&this.active!==this.iconDialog){this.iconDialog.clear();}
if(this.videoDialog&&this.active!==this.videoDialog){this.videoDialog.clear();}}else{this.media=document.createElement("img");this.range.insertNode(this.media,true);this.active.media=this.media;}
this.active.save();if(this.active.add_class){$(this.active.media).addClass(this.active.add_class);}
var media=this.active.media;$(document.body).trigger("media-saved",[media,self.old_media]);self.trigger("saved",[media,self.old_media]);setTimeout(function(){if(!media.parentNode){return;}
range.createFromNode(media).select();click_event(media,"mousedown");if(!this.only_images){setTimeout(function(){if($(media).parent().data("oe-field")!=="image"){click_event(media,"click");}
click_event(media,"mouseup");},0);}},0);this.close();},searchTimer:null,search:function(){var self=this;var needle=this.$("input#icon-search").val();clearTimeout(this.searchTimer);this.searchTimer=setTimeout(function(){self.active.search(needle||"");},250);}});var IMAGES_PER_ROW=6;var IMAGES_ROWS=2;var ImageDialog=Widget.extend({template:'web_editor.dialog.image',events:_.extend({},Dialog.prototype.events,{'change .url-source':function(e){this.changed($(e.target));},'click button.filepicker':function(){var filepicker=this.$('input[type=file]');if(!_.isEmpty(filepicker)){filepicker[0].click();}},'click .js_disable_optimization':function(){this.$('input[name="disable_optimization"]').val('1');var filepicker=this.$('button.filepicker');if(!_.isEmpty(filepicker)){filepicker[0].click();}},'change input[type=file]':'file_selection','submit form':'form_submit','change input.url':"change_input",'keyup input.url':"change_input",'click .existing-attachments [data-src]':'select_existing','click .existing-attachment-remove':'try_remove','keydown.dismiss.bs.modal':function(){},}),init:function(parent,media,options){this._super();this.options=options||{};this.accept=this.options.accept||this.options.document?"*/*":"image/*";this.domain=this.options.domain||['|',['mimetype','=',false],['mimetype',this.options.document?'not in':'in',['image/gif','image/jpe','image/jpeg','image/jpg','image/gif','image/png']]];this.parent=parent;this.old_media=media;this.media=media;this.images=[];this.page=0;},start:function(){this.$preview=this.$('.preview-container').detach();var self=this;var res=this._super();var o={url:null,alt:null};if($(this.media).is("img")){o.url=this.media.getAttribute('src');}else if($(this.media).is("a.o_image")){o.url=this.media.getAttribute('href').replace(/[?].*/,'');o.id=+o.url.match(/\/web\/content\/([0-9]*)/,'')[1];}
this.parent.$(".pager > li").click(function(e){if(!self.$el.is(':visible')){return;}
e.preventDefault();var $target=$(e.currentTarget);if($target.hasClass('disabled')){return;}
self.page+=$target.hasClass('previous')?-1:1;self.display_attachments();});this.fetch_existing().then(function(){if(o.url){self.set_image(_.find(self.records,function(record){return record.url===o.url;})||o);}});return res;},push:function(attachment){if(this.options.select_images){var img=_.select(this.images,function(v){return v.id==attachment.id;});if(img.length){this.images.splice(this.images.indexOf(img[0]),1);}}else{this.images=[];}
this.images.push(attachment);},save:function(){if(this.options.select_images){this.parent.trigger("save",this.images);return this.images;}
this.parent.trigger("save",this.media);var img=this.images[0];if(!img){var id=this.$(".existing-attachments [data-src]:first").data('id');img=_.find(this.images,function(img){return img.id===id;});}
if(!img.is_document){if(this.media.tagName!=="IMG"||!this.old_media){this.add_class="pull-left";this.style={"width":"100%"};}
if(this.media.tagName!=="IMG"){var media=document.createElement('img');$(this.media).replaceWith(media);this.media=media;}
this.media.setAttribute('src',img.src);}else{if(this.media.tagName!=="A"){$('.note-control-selection').hide();var media=document.createElement('a');$(this.media).replaceWith(media);this.media=media;}
this.media.setAttribute('href','/web/content/'+img.id+'?unique='+img.checksum+'&download=true');$(this.media).addClass('o_image').attr('title',img.name).attr('data-mimetype',img.mimetype);}
$(this.media).attr('alt',img.alt);var style=this.style;if(style){$(this.media).css(style);}
return this.media;},clear:function(){this.media.className=this.media.className.replace(/(^|\s+)((img(\s|$)|img-(?!circle|rounded|thumbnail))[^\s]*)/g,' ');},cancel:function(){this.trigger('cancel');},change_input:function(e){var $input=$(e.target);var $button=$input.parent().find("button");if($input.val()===""){$button.addClass("btn-default").removeClass("btn-primary");}else{$button.removeClass("btn-default").addClass("btn-primary");}},search:function(needle){var self=this;this.fetch_existing(needle).then(function(){self.selected_existing();});},set_image:function(attachment,error){var self=this;this.push(attachment);this.$('input.url').val('');this.fetch_existing().then(function(){self.selected_existing();});},form_submit:function(event){var self=this;var $form=this.$('form[action="/web_editor/attachment/add"]');if(!$form.find('input[name="upload"]').val().length){var url=$form.find('input[name="url"]').val();if(this.selected_existing().size()){event.preventDefault();return false;}}
$form.find('.well > div').hide().last().after('<span class="fa fa-spin fa-3x fa-refresh"/>');var callback=_.uniqueId('func_');this.$('input[name=func]').val(callback);window[callback]=function(attachments,error){delete window[callback];$form.find('.well > span').remove();$form.find('.well > div').show();_.each(attachments,function(record){record.src=record.url||'/web/image/'+record.id;record.is_document=!(/gif|jpe|jpg|png/.test(record.mimetype));});if(error||!attachments.length){self.file_selected(null,error||!attachments.length);}
self.images=attachments;for(var i=0;i<attachments.length;i++){self.file_selected(attachments[i],error);}};},file_selection:function(){this.$el.addClass('nosave');this.$('form').removeClass('has-error').find('.help-block').empty();this.$('button.filepicker').removeClass('btn-danger btn-success');this.$('form').submit();},file_selected:function(attachment,error){var $button=this.$('button.filepicker');if(!error){$button.addClass('btn-success');this.set_image(attachment);}else{this.$('form').addClass('has-error').find('.help-block').text(error);$button.addClass('btn-danger');}
if(!this.options.select_images){this.parent.save();}},fetch_existing:function(needle){var domain=[['res_model','=','ir.ui.view']].concat(this.domain);if(needle&&needle.length){domain.push('|',['datas_fname','ilike',needle],['name','ilike',needle]);}
return ajax.jsonRpc('/web/dataset/call_kw','call',{model:'ir.attachment',method:'search_read',args:[],kwargs:{domain:domain,fields:['name','mimetype','checksum','url'],order:'id desc',context:base.get_context()}}).then(this.proxy('fetched_existing'));},fetched_existing:function(records){this.records=records;_.each(records,function(record){record.src=record.url||'/web/image/'+record.id;record.is_document=!(/gif|jpe|jpg|png/.test(record.mimetype));});this.display_attachments();},display_attachments:function(){var self=this;var per_screen=IMAGES_PER_ROW*IMAGES_ROWS;var from=this.page*per_screen;var records=this.records;var rows=_(records).chain().slice(from,from+per_screen).groupBy(function(_,index){return Math.floor(index/IMAGES_PER_ROW);}).values().value();this.$('.help-block').empty();this.$('.existing-attachments').replaceWith(QWeb.render('web_editor.dialog.image.existing.content',{rows:rows}));this.parent.$('.pager').find('li.previous').toggleClass('disabled',(from===0)).end().find('li.next').toggleClass('disabled',(from+per_screen>=records.length));this.$el.find('.o_image').each(function(){var $div=$(this);if(/gif|jpe|jpg|png/.test($div.data('mimetype'))){var $img=$('<img/>').addClass('img img-responsive').attr('src',$div.data('url')||$div.data('src'));$div.addClass('o_webimage').append($img);}});this.selected_existing();},select_existing:function(e){var $img=$(e.currentTarget);var attachment=_.find(this.records,function(record){return record.id===$img.data('id');});this.push(attachment);this.selected_existing();},selected_existing:function(){var self=this;this.$('.existing-attachment-cell.media_selected').removeClass("media_selected");var $select=this.$('.existing-attachment-cell [data-src]').filter(function(){var $img=$(this);return!!_.find(self.images,function(v){return(v.url===$img.data("src")||($img.data("url")&&v.url===$img.data("url"))||v.id===$img.data("id"));});});$select.closest('.existing-attachment-cell').addClass("media_selected");return $select;},try_remove:function(e){var $help_block=this.$('.help-block').empty();var self=this;var $a=$(e.target);var id=parseInt($a.data('id'),10);var attachment=_.findWhere(this.records,{id:id});var $both=$a.parent().children();$both.css({borderWidth:"5px",borderColor:"#f00"});return ajax.jsonRpc('/web_editor/attachment/remove','call',{'ids':[id]}).then(function(prevented){if(_.isEmpty(prevented)){self.records=_.without(self.records,attachment);self.display_attachments();return;}
$both.css({borderWidth:"",borderColor:""});$help_block.replaceWith(QWeb.render('web_editor.dialog.image.existing.error',{views:prevented[id]}));});},});var cacheCssSelectors={};var getCssSelectors=function(filter){var css=[];if(cacheCssSelectors[filter]){return cacheCssSelectors[filter];}
var sheets=document.styleSheets;for(var i=0;i<sheets.length;i++){var rules;if(sheets[i].rules){rules=sheets[i].rules;}else{try{rules=sheets[i].cssRules;}catch(e){console.warn("Can't read the css rules of: "+sheets[i].href,e);continue;}}
if(rules){for(var r=0;r<rules.length;r++){var selectorText=rules[r].selectorText;if(selectorText){selectorText=selectorText.split(/\s*,\s*/);var data=null;for(var s=0;s<selectorText.length;s++){var match=selectorText[s].match(filter);if(match){var clean=match[1].slice(1).replace(/::?before$/,'');if(!data){data=[match[1],rules[r].cssText.replace(/(^.*\{\s*)|(\s*\}\s*$)/g,''),clean,[clean]];}else{data[0]+=(", "+match[1]);data[3].push(clean);}}}
if(data){css.push(data);}}}}}
return cacheCssSelectors[filter]=css;};var computeFonts=_.once(function(){_.each(fontIcons,function(data){data.cssData=getCssSelectors(data.parser);data.alias=[];data.icons=_.map(data.cssData,function(css){data.alias.push.apply(data.alias,css[3]);return css[2];});});});rte.Class.include({init:function(EditorBar){this._super.apply(this,arguments);computeFonts();},onEnableEditableArea:function($editable){if($editable.data('oe-type')==="monetary"){$editable.attr('contenteditable',false);$editable.find('.oe_currency_value').attr('contenteditable',true);}
if($editable.is('[data-oe-model]')&&!$editable.is('[data-oe-model="ir.ui.view"]')&&!$editable.is('[data-oe-type="html"]')){$editable.data('layoutInfo').popover().find('.btn-group:not(.note-history)').remove();}},});var fontIcons=[{'base':'fa','parser':/(?=^|\s)(\.fa-[0-9a-z_-]+::?before)/i}];var fontIconsDialog=Widget.extend({template:'web_editor.dialog.font-icons',events:_.extend({},Dialog.prototype.events,{'click .font-icons-icon':function(e){e.preventDefault();e.stopPropagation();this.$('#fa-icon').val(e.target.getAttribute('data-id'));$(".font-icons-icon").removeClass("font-icons-selected");$(e.target).addClass("font-icons-selected");},'keydown.dismiss.bs.modal':function(){},}),renderElement:function(){this.iconsParser=fontIcons;this.icons=_.flatten(_.map(fontIcons,function(data){return data.icons;}));this._super();},init:function(parent,media){this._super();this.parent=parent;this.media=media;computeFonts();},start:function(){return this._super().then(this.proxy('load_data'));},search:function(needle){var iconsParser=this.iconsParser;if(needle){var iconsParser=[];_.filter(this.iconsParser,function(data){var cssData=_.filter(data.cssData,function(cssData){return _.find(cssData[3],function(alias){return alias.indexOf(needle)!==-1;});});if(cssData.length){iconsParser.push({base:data.base,cssData:cssData});}});}
this.$('div.font-icons-icons').html(QWeb.render('web_editor.dialog.font-icons.icons',{'iconsParser':iconsParser}));},save:function(){var self=this;this.parent.trigger("save",this.media);var icons=this.icons;var style=this.media.attributes.style?this.media.attributes.style.value:'';var classes=(this.media.className||"").split(/\s+/);var custom_classes=/^fa(-[1-5]x|spin|rotate-(9|18|27)0|flip-(horizont|vertic)al|fw|border)?$/;var non_fa_classes=_.reject(classes,function(cls){return self.getFont(cls)||custom_classes.test(cls);});var final_classes=non_fa_classes.concat(this.get_fa_classes());if(this.media.tagName!=="SPAN"){var media=document.createElement('span');$(media).data($(this.media).data());$(this.media).replaceWith(media);this.media=media;style=style.replace(/\s*width:[^;]+/,'');}
$(this.media).attr("class",_.compact(final_classes).join(' ')).attr("style",style);},getFont:function(classNames){if(!(classNames instanceof Array)){classNames=(classNames||"").split(/\s+/);}
var fontIcon,cssData;for(var k=0;k<this.iconsParser.length;k++){fontIcon=this.iconsParser[k];for(var s=0;s<fontIcon.cssData.length;s++){cssData=fontIcon.cssData[s];if(_.intersection(classNames,cssData[3]).length){return{'base':fontIcon.base,'parser':fontIcon.parser,'icons':fontIcon.icons,'font':cssData[2]};}}}
return null;},load_data:function(){var classes=(this.media&&this.media.className||"").split(/\s+/);for(var i=0;i<classes.length;i++){var cls=classes[i];switch(cls){case'fa-1x':case'fa-2x':case'fa-3x':case'fa-4x':case'fa-5x':this.$('#fa-size').val(cls);continue;case'fa-spin':case'fa-rotate-90':case'fa-rotate-180':case'fa-rotate-270':case'fa-flip-horizontal':case'fa-rotate-vertical':this.$('#fa-rotation').val(cls);continue;case'fa-fw':continue;case'fa-border':this.$('#fa-border').prop('checked',true);continue;case'':continue;default:$(".font-icons-icon").removeClass("font-icons-selected").filter("[data-alias*=',"+cls+",']").addClass("font-icons-selected");for(var k=0;k<this.icons.length;k++){if(this.icons.indexOf(cls)!==-1){this.$('#fa-icon').val(cls);break;}}}}},get_fa_classes:function(){var font=this.getFont(this.$('#fa-icon').val());return[font?font.base:'fa',font?font.font:"",this.$('#fa-size').val(),this.$('#fa-rotation').val(),this.$('#fa-border').prop('checked')?'fa-border':''];},clear:function(){this.media.className=this.media.className.replace(/(^|\s)(fa(\s|$)|fa-[^\s]*)/g,' ');},});function createVideoNode(url,options){options=options||{};var ytRegExp=/^(?:(?:https?:)?\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;var ytMatch=url.match(ytRegExp);var igRegExp=/\/\/instagram.com\/p\/(.[a-zA-Z0-9]*)/;var igMatch=url.match(igRegExp);var vRegExp=/\/\/vine.co\/v\/(.[a-zA-Z0-9]*)/;var vMatch=url.match(vRegExp);var vimRegExp=/\/\/(player.)?vimeo.com\/([a-z]*\/)*([0-9]{6,11})[?]?.*/;var vimMatch=url.match(vimRegExp);var dmRegExp=/.+dailymotion.com\/(video|hub)\/([^_]+)[^#]*(#video=([^_&]+))?/;var dmMatch=url.match(dmRegExp);var youkuRegExp=/\/\/v\.youku\.com\/v_show\/id_(\w+)\.html/;var youkuMatch=url.match(youkuRegExp);var $video=$('<iframe>');if(ytMatch&&ytMatch[1].length===11){var youtubeId=ytMatch[1];$video=$('<iframe>').attr('src','//www.youtube.com/embed/'+youtubeId).attr('width','640').attr('height','360');}else if(igMatch&&igMatch[0].length){$video=$('<iframe>').attr('src',igMatch[0]+'/embed/').attr('width','612').attr('height','710').attr('scrolling','no').attr('allowtransparency','true');}else if(vMatch&&vMatch[0].length){$video=$('<iframe>').attr('src',vMatch[0]+'/embed/simple').attr('width','600').attr('height','600').attr('class','vine-embed');}else if(vimMatch&&vimMatch[3].length){$video=$('<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>').attr('src','//player.vimeo.com/video/'+vimMatch[3]).attr('width','640').attr('height','360');}else if(dmMatch&&dmMatch[2].length){$video=$('<iframe>').attr('src','//www.dailymotion.com/embed/video/'+dmMatch[2]).attr('width','640').attr('height','360');}else if(youkuMatch&&youkuMatch[1].length){$video=$('<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>').attr('height','498').attr('width','510').attr('src','//player.youku.com/embed/'+youkuMatch[1]);}else{$video=$('<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>').attr('width','640').attr('height','360').attr('src',url);}
if(options.autoplay){$video.attr("src",$video.attr("src")+"?autoplay=1");}
$video.attr('frameborder',0);return $video;}
var VideoDialog=Widget.extend({template:'web_editor.dialog.video',events:_.extend({},Dialog.prototype.events,{'click input#urlvideo ~ button':'get_video','click input#embedvideo ~ button':'get_embed_video','change input#autoplay':'get_video','change input#urlvideo':'change_input','keyup input#urlvideo':'change_input','change input#embedvideo':'change_input','keyup input#embedvideo':'change_input','keydown.dismiss.bs.modal':function(){},}),init:function(parent,media){this._super();this.parent=parent;this.media=media;},start:function(){this.$preview=this.$('.preview-container').detach();this.$iframe=this.$("iframe");var $media=$(this.media);if($media.hasClass("media_iframe_video")){var src=$media.data('src');this.$("input#urlvideo").val(src);this.$("input#autoplay").prop("checked",(src||"").indexOf("autoplay")>=0);this.get_video();}
return this._super();},change_input:function(e){var $input=$(e.target);var $button=$input.parent().find("button");if($input.val()===""){$button.addClass("btn-default").removeClass("btn-primary");}else{$button.removeClass("btn-default").addClass("btn-primary");}},get_embed_video:function(event){event.preventDefault();var embedvideo=this.$("input#embedvideo").val().match(/src=["']?([^"']+)["' ]?/);if(embedvideo){this.$("input#urlvideo").val(embedvideo[1]);this.get_video(event);}
return false;},get_video:function(event){if(event)event.preventDefault();var $video=createVideoNode(this.$("input#urlvideo").val(),{autoplay:this.$("input#autoplay").is(":checked")});this.$iframe.replaceWith($video);this.$iframe=$video;return false;},save:function(){this.parent.trigger("save",this.media);var video_id=this.$("#video_id").val();if(!video_id){this.$("button.btn-primary").click();video_id=this.$("#video_id").val();}
var video_type=this.$("#video_type").val();var $iframe=$('<div class="media_iframe_video" data-src="'+this.$iframe.attr("src")+'">'+'<div class="css_editable_mode_display">&nbsp;</div>'+'<div class="media_iframe_video_size" contentEditable="false">&nbsp;</div>'+'<iframe src="'+this.$iframe.attr("src")+'" frameborder="0" allowfullscreen="allowfullscreen" contentEditable="false"></iframe>'+'</div>');$(this.media).replaceWith($iframe);this.media=$iframe[0];},clear:function(){if(this.media.dataset.src){try{delete this.media.dataset.src;}catch(e){this.media.dataset.src=undefined;}}
this.media.className=this.media.className.replace(/(^|\s)media_iframe_video(\s|$)/g,' ');},});var LinkDialog=Dialog.extend({template:'web_editor.dialog.link',events:_.extend({},Dialog.prototype.events,{'change :input.url-source':'changed','keyup :input.url':'onkeyup','keyup :input':'preview','click button.remove':'remove_link','change input#link-text':function(e){this.text=$(e.target).val();},'change .link-style':function(e){this.preview();},}),init:function(editable,linkInfo){this._super(editable,linkInfo);this.editable=editable;this.data=linkInfo||{};this.data.className="";if(this.data.range){this.data.iniClassName=$(this.data.range.sc).filter("a").attr("class")||"";this.data.className=this.data.iniClassName.replace(/(^|\s+)btn(-[a-z0-9_-]*)?/gi,' ');var is_link=this.data.range.isOnAnchor();var r=this.data.range;var sc=r.sc;var so=r.so;var ec=r.ec;var eo=r.eo;var nodes;if(!is_link){if(sc.tagName){sc=dom.firstChild(so?sc.childNodes[so]:sc);so=0;}else if(so!==sc.textContent.length){if(sc===ec){ec=sc=sc.splitText(so);eo-=so;}else{sc=sc.splitText(so);}
so=0;}
if(ec.tagName){ec=dom.lastChild(eo?ec.childNodes[eo-1]:ec);eo=ec.textContent.length;}else if(eo!==ec.textContent.length){ec.splitText(eo);}
nodes=dom.listBetween(sc,ec);if(dom.isVoid(sc)||dom.isImg(sc)){so=dom.listPrev(sc).length-1;sc=sc.parentNode;}
if(dom.isBR(ec)){eo=dom.listPrev(ec).length-1;ec=ec.parentNode;}else if(dom.isVoid(ec)||dom.isImg(sc)){eo=dom.listPrev(ec).length;ec=ec.parentNode;}
this.data.range=range.create(sc,so,ec,eo);this.data.range.select();}else{nodes=dom.ancestor(sc,dom.isAnchor).childNodes;}
if(dom.isImg(sc)&&nodes.indexOf(sc)===-1){nodes.push(sc);}
if(nodes.length>1||dom.ancestor(nodes[0],dom.isImg)){var text="";this.data.images=[];for(var i=0;i<nodes.length;i++){if(dom.ancestor(nodes[i],dom.isImg)){this.data.images.push(dom.ancestor(nodes[i],dom.isImg));text+='[IMG]';}else if(!is_link&&i===0){text+=nodes[i].textContent.slice(so,Infinity);}else if(!is_link&&i===nodes.length-1){text+=nodes[i].textContent.slice(0,eo);}else{text+=nodes[i].textContent;}}
this.data.text=text;}}
this.data.text=this.data.text.replace(/[ \t\r\n]+/g,' ');},start:function(){this.bind_data();this.$('input.url-source:eq(1)').closest('.list-group-item').addClass('active');return this._super();},get_data:function(test){var self=this;var def=new $.Deferred();var $e=this.$('.active input.url-source');if(!$e.length){$e=this.$('input.url-source:first');}
var val=$e.val();var label=this.$('#link-text').val()||val;if(label&&this.data.images){for(var i=0;i<this.data.images.length;i++){label=label.replace(/</,"&lt;").replace(/>/,"&gt;").replace(/\[IMG\]/,this.data.images[i].outerHTML);}}
if(!test&&(!val||!$e[0].checkValidity())){$e.closest('.form-group').addClass('has-error');$e.focus();def.reject();}
var style=this.$("input[name='link-style-type']:checked").val()||'';var size=this.$("input[name='link-style-size']:checked").val()||'';var classes=(this.data.className||"")+(style&&style.length?" btn ":"")+style+" "+size;var isNewWindow=this.$('input.window-new').prop('checked');if($e.hasClass('email-address')&&$e.val().indexOf("@")!==-1){self.get_data_buy_mail(def,$e,isNewWindow,label,classes,test);}else{self.get_data_buy_url(def,$e,isNewWindow,label,classes,test);}
return def;},get_data_buy_mail:function(def,$e,isNewWindow,label,classes,test){var val=$e.val();def.resolve(val.indexOf("mailto:")===0?val:'mailto:'+val,isNewWindow,label,classes);},get_data_buy_url:function(def,$e,isNewWindow,label,classes,test){def.resolve($e.val(),isNewWindow,label,classes);},save:function(){var self=this;var _super=this._super.bind(this);return this.get_data().then(function(url,new_window,label,classes){self.data.url=url;self.data.isNewWindow=new_window;self.data.text=label;self.data.className=classes.replace(/\s+/gi,' ').replace(/^\s+|\s+$/gi,'');self.trigger("save",self.data);}).then(_super);},bind_data:function(){var href=this.data.url;var new_window=this.data.isNewWindow;var text=this.data.text;var classes=this.data.iniClassName;this.$('input#link-text').val(text);this.$('input.window-new').prop('checked',new_window);if(classes){this.$('input[value!=""]').each(function(){var $option=$(this);if(classes.indexOf($option.val())!==-1){$option.attr("checked","checked");}});}
if(href){var match;if(match=/mailto:(.+)/.exec(href)){this.$('input.email-address').val(match=/mailto:(.+)/.exec(href)?match[1]:'');}else{this.$('input.url').val(href);}}
this.preview();},changed:function(e){$(e.target).closest('.list-group-item').addClass('active').siblings().removeClass('active').addBack().removeClass('has-error');this.preview();},onkeyup:function(e){var $e=$(e.target);var is_link=($e.val()||'').length&&$e.val().indexOf("@")===-1;this.$('input.window-new').closest("div").toggle(is_link);this.preview();},preview:function(){var $preview=this.$("#link-preview");this.get_data(true).then(function(url,new_window,label,classes){$preview.attr("target",new_window?'_blank':"").attr("href",url&&url.length?url:"#").html((label&&label.length?label:url)).attr("class",classes.replace(/pull-\w+/,''));});}});return{'getCssSelectors':getCssSelectors,'Dialog':Dialog,'alt':alt,'MediaDialog':MediaDialog,'fontIcons':fontIcons,'LinkDialog':LinkDialog};});;

/* /web_editor/static/src/js/snippets.editor.js defined in bundle 'web_editor.editor' */
odoo.define('web_editor.snippet.editor',function(require){'use strict';var Class=require('web.Class');var ajax=require('web.ajax');var core=require('web.core');var Widget=require('web.Widget');var base=require('web_editor.base');var editor=require('web_editor.editor');var animation=require('web_editor.snippets.animation');var options=require('web_editor.snippets.options');var qweb=core.qweb;var dummy=editor.dummy;ajax.loadXML('/web_editor/static/src/xml/snippets.xml',qweb);editor.Class.include({init:function(){var self=this;var res=this._super.apply(this,arguments);var $editable=this.rte.editable();this.buildingBlock=new BuildingBlock(this,$editable);this.buildingBlock.on("snippets:ready",this,function(){self.trigger("snippets:ready");});return res;},start:function(){var self=this;animation.stop();this.buildingBlock.insertAfter(this.$el);animation.start(true);this.rte.editable().find("*").off('mousedown mouseup click');return this._super();},save:function(){this.buildingBlock.clean_for_save();this._super();},});$.extend($.expr[':'],{hasData:function(node,i,m){return!!_.toArray(node.dataset).length;},data:function(node,i,m){return $(node).data(m[3]);}});var globalSelector={closest:function(){return $();},all:function(){return $();},is:function(){return false;},};$.fn.extend({activateBlock:function(){var target=globalSelector.closest($(this))[0]||(dom.isBR(this)?this.parentNode:dom.node(this));var evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,target);target.dispatchEvent(evt);return this;}});var BuildingBlock=Widget.extend({template:'web_editor.snippets',activeSnippets:[],init:function(parent,$editable){this.parent=parent;this.$editable=$editable;this._super.apply(this,arguments);if(!$('#oe_manipulators').length){$("<div id='oe_manipulators' class='o_css_editor'></div>").appendTo('body');}
this.$active_snipped_id=false;this.snippets=[];data.instance=this;},start:function(){var self=this;this.$snippet=$("#oe_snippets");this.$el.on("mouseenter",function(){self.show();}).on("mouseleave",function(event){if(event.clientX>0&&event.clientY>0)self.hide();});$(window).resize(function(){setTimeout('$(document).click()',0);});this.fetch_snippet_templates();this.bind_snippet_click_editor();$(document).on('click','.dropdown-submenu a[tabindex]',function(e){e.preventDefault();});var _isNotBreakable=$.summernote.core.dom.isNotBreakable;$.summernote.core.dom.isNotBreakable=function(node){return _isNotBreakable(node)||$(node).is('div')||globalSelector.is($(node));};$(window).on('resize',function(){if(self.$active_snipped_id&&self.$active_snipped_id.data("snippet-editor")){self.cover_target(self.$active_snipped_id.data("snippet-editor").$overlay,self.$active_snipped_id);}});$(document).on('mousemove',function(){if(self.$active_snipped_id&&self.$active_snipped_id.data("snippet-editor")){self.$active_snipped_id.data("snippet-editor").$overlay.removeClass('o_keypress');}});$(document).on('keydown',function(event){if(self.$active_snipped_id&&self.$active_snipped_id.data("snippet-editor")){self.$active_snipped_id.data("snippet-editor").$overlay.addClass('o_keypress');}
if((event.metaKey||(event.ctrlKey&&!event.altKey))&&event.shiftKey&&event.keyCode>=48&&event.keyCode<=57){self.$snippet.find('.scroll:first > ul li:eq('+(event.keyCode-49)+') a').trigger("click");self.show();event.preventDefault();}});},_get_snippet_url:function(){return'/web_editor/snippets';},_add_check_selector:function(selector,no_check,is_children){var self=this;var selector=selector.split(/\s*,/).join(":not(.o_snippet_not_selectable), ")+":not(.o_snippet_not_selectable)";if(no_check){return{closest:function($from,parentNode){return $from.closest(selector,parentNode);},all:function($from){return $from?$from.find(selector):$(selector);},is:function($from){return $from.is(selector);}};}else{var selector=selector.split(/\s*,/).join(":o_editable, ")+":o_editable";return{closest:function($from,parentNode){var parents=self.$editable.get();return $from.closest(selector,parentNode).filter(function(){var node=this;while(node.parentNode){if(parents.indexOf(node)!==-1){return true;}
node=node.parentNode;}
return false;});},all:is_children?function($from){return($from||self.$editable).find(selector);}:function($from){return $from?$from.find(selector):self.$editable.filter(selector).add(self.$editable.find(selector));},is:function($from){return $from.is(selector);}};}},fetch_snippet_templates:function(){var self=this;var url=this._get_snippet_url();if(!url||!url.length){this.$snippet.detach();return;}
this.$el.find("#o_left_bar").addClass("hidden");return ajax.jsonRpc(url,'call',{}).then(function(html){self.compute_snippet_templates(html);self.trigger("snippets:ready");},function(){self.$snippet.hide();console.warn('Snippets template not found:',url);});},compute_snippet_templates:function(html){var self=this;var $html=$(html);var $left_bar=this.$el.find("#o_left_bar");var $ul=$html.siblings("ul");var $scroll=$html.siblings("#o_scroll");if(!$scroll.length){throw new Error("Wrong snippets xml definition");}
$ul.children().tooltip({delay:{"show":500,"hide":100},container:'body',title:function(){return(navigator.appVersion.indexOf('Mac')>-1?'CMD':'CTRL')+'+SHIFT+'+($(this).index()+1);},trigger:'hover',placement:'top'}).on('click',function(){$(this).tooltip('hide');});$html.find('[data-oe-type="snippet"][data-oe-name]').each(function(){var $div=$('<div/>').insertAfter(this).append(this).attr('name',$(this).data('oe-name'));});self.templateOptions=[];var selector=[];var $styles=$html.find("[data-js], [data-selector]");$styles.each(function(){var $style=$(this);var no_check=$style.data('no-check');var option_id=$style.data('js');var option={'option':option_id,'base_selector':$style.data('selector'),'selector':self._add_check_selector($style.data('selector'),no_check),'$el':$style,'drop-near':$style.data('drop-near')&&self._add_check_selector($style.data('drop-near'),no_check,true),'drop-in':$style.data('drop-in')&&self._add_check_selector($style.data('drop-in'),no_check),'data':$style.data()};self.templateOptions.push(option);selector.push(option.selector);});$styles.addClass("hidden");globalSelector.closest=function($from){var $temp;var $target;var len=selector.length;for(var i=0;i<len;i++){$temp=selector[i].closest($from,$target&&$target[0]);if(!$target||$temp.length){$target=$temp;}}
return $target;};globalSelector.all=function($from){var $target;var len=selector.length;for(var i=0;i<len;i++){if(!$target)$target=selector[i].all($from);else $target=$target.add(selector[i].all($from));}
return $target;};globalSelector.is=function($from){var len=selector.length;for(var i=0;i<len;i++){if(selector[i].is($from)){return true;}}
return false;};var number=0;self.$snippets=$scroll.find(".o_panel_body").children().addClass("oe_snippet").each(function(){if(!$('.oe_snippet_thumbnail',this).size()){var $div=$('<div class="oe_snippet_thumbnail">'+'<div class="oe_snippet_thumbnail_img"/>'+'<span class="oe_snippet_thumbnail_title"></span>'+'</div>');$div.find('span').text($(this).attr("name"));$(this).prepend($div);var thumbnail=$("[data-oe-thumbnail]",this).data("oe-thumbnail");if(thumbnail){$div.find('.oe_snippet_thumbnail_img').css('background-image','url('+thumbnail+')');}}
if(!$(this).data("selector")){$("> *:not(.oe_snippet_thumbnail)",this).addClass('oe_snippet_body');}
number++;});if(!number){this.$snippet.detach();}else{this.$el.find("#o_left_bar").removeClass("hidden");}
$("body").toggleClass("editor_has_snippets",!!number);self.$snippets.find('.oe_snippet_body, .oe_snippet_body *').contents().filter(function(){return this.nodeType===3&&this.textContent.match(/\S/);}).parent().addClass("o_default_snippet_text");$(document).on("mouseup",".o_default_snippet_text",function(event){$(event.target).selectContent();});$(document).on("keyup",function(event){var r=$.summernote.core.range.create();$(r&&r.sc).closest(".o_default_snippet_text").removeClass("o_default_snippet_text");});$html.find('[data-oe-model], [data-oe-type]').each(function(){for(var k=0;k<this.attributes.length;k++){if(this.attributes[k].name.indexOf('data-oe-')===0){$(this).removeAttr(this.attributes[k].name);k--;}}});$html.find('.o_not_editable').attr("contentEditable",false);$left_bar.html($html);$left_bar.on('click','.scroll-link',function(event){event.preventDefault();var targetOffset=$($(this).attr("href")).position().top-$ul.outerHeight()+$scroll[0].scrollTop;$scroll.animate({'scrollTop':targetOffset},750);});$scroll.on('scroll',function(){var middle=$scroll.height()/4;var $li=$ul.find("a").parent().removeClass('active');var last;for(var k=0;k<$li.length;k++){var li=$($li[k]);if(!li.data('target')){li.data('target',$($("a",li).attr("href")));}
if(li.data('target').position().top>middle){break;}
last=$li[k];}
$(last).addClass("active");});$(window).on('resize',function(){$scroll.css("overflow","");var height=$left_bar.height()-$ul.outerHeight();$scroll.css("height",height);var $last=$scroll.children(":visible").last().children(".o_panel_body");$last.css({'min-height':(height-$last.prev().outerHeight())+'px'});if($scroll[0].scrollHeight+$ul[0].scrollHeight>document.body.clientHeight){$scroll.css("overflow","auto").css("width","226px");}else{$scroll.css("width","");}}).trigger('resize');self.make_snippet_draggable(self.$snippets);},cover_target:function($el,$target){if($el.data('not-cover_target'))return;var pos=$target.offset();var mt=parseInt($target.css("margin-top")||0);var mb=parseInt($target.css("margin-bottom")||0);var width=$target.outerWidth();var bigger=pos.left+width>$("body").outerWidth()-8;$el.css({'width':width,'top':pos.top-mt-5,'left':pos.left-1});$el.find(".oe_handle.e,.oe_handle.w").css({'height':$target.outerHeight()+mt+mb+1});if(bigger){$el.find(".oe_handle.e").css({right:0,margin:0}).find("div").css({right:0,left:'auto'});}else{$el.find(".oe_handle.e").css({right:"",margin:""}).find("div").css({right:"",left:""});}
$el.find(".oe_handle.s").css({'top':$target.outerHeight()+mt+mb});$el.find(".oe_handle.size").css({'top':$target.outerHeight()+mt});$el.find(".oe_handle.s,.oe_handle.n").css({'width':width-2});},show_blocks:function(){var self=this;var cache={};this.$snippet.find(".o_panel").each(function(){var catcheck=false;var $category=$(this);$category.find(".oe_snippet_body").each(function(){var $snippet=$(this);var check=false;for(var k in self.templateOptions){var option=self.templateOptions[k];if($snippet.is(option.base_selector)){cache[k]=cache[k]||{'drop-near':option['drop-near']?option['drop-near'].all():[],'drop-in':option['drop-in']?option['drop-in'].all():[]};if(cache[k]['drop-near'].length||cache[k]['drop-in'].length){catcheck=true;check=true;break;}}}
if(check){$snippet.closest(".oe_snippet").removeClass("disable");}else{$snippet.closest(".oe_snippet").addClass("disable");}});$('#oe_snippets .scroll a[data-toggle="tab"][href="#'+$category.attr("id")+'"]').toggle(catcheck);});},show:function(){var self=this;this.make_active(false);this.$el.addClass("o_open");this.show_blocks();},hide:function(){this.$el.removeClass("o_open");},bind_snippet_click_editor:function(){var self=this;var snipped_event_flag;$(document).on('click','*',function(event){var srcElement=event.srcElement||(event.originalEvent&&(event.originalEvent.originalTarget||event.originalEvent.target)||event.target);if(self.editor_busy||snipped_event_flag===srcElement||!srcElement){return;}
snipped_event_flag=srcElement;setTimeout(function(){snipped_event_flag=false;},0);var $target=$(srcElement);if($target.closest(".oe_overlay, .note-popover").length){return;}
if(!globalSelector.is($target)){$target=globalSelector.closest($target);}
if(self.$active_snipped_id&&self.$active_snipped_id.is($target)){return;}
self.make_active($target);});},snippet_blur:function($snippet){if($snippet){if($snippet.data("snippet-editor")){$snippet.data("snippet-editor").on_blur();}}},snippet_focus:function($snippet){if($snippet){if($snippet.data("snippet-editor")){$snippet.data("snippet-editor").on_focus();}}},clean_for_save:function(){var self=this;var opt=options.registry;var template=self.templateOptions;for(var k in template){var Option=opt[template[k]['option']];if(Option&&Option.prototype.clean_for_save!==dummy){template[k].selector.all().filter(function(){var node=this;while(!/o_dirty|o_editable/.test(node.className)&&node!==document){node=node.parentNode;}
return node.className.indexOf("o_dirty")!==-1;}).each(function(){new Option(self,null,$(this),k).clean_for_save();});}}
this.$editable.find("*[contentEditable], *[attributeEditable]").removeAttr('contentEditable').removeProp('contentEditable').removeAttr('attributeEditable').removeProp('attributeEditable');},make_active:function($snippet){if($snippet&&this.$active_snipped_id&&this.$active_snipped_id.get(0)===$snippet.get(0)){return;}
if(this.$active_snipped_id){this.snippet_blur(this.$active_snipped_id);this.$active_snipped_id=false;}
if($snippet&&$snippet.length){if(_.indexOf(this.snippets,$snippet.get(0))===-1){this.snippets.push($snippet.get(0));}
this.$active_snipped_id=$snippet;this.create_snippet_editor(this.$active_snipped_id);this.cover_target($snippet.data('overlay'),$snippet);this.snippet_focus($snippet);}
this.$snippet.trigger('snippet-activated',$snippet);if($snippet){$snippet.trigger('snippet-activated',$snippet);}},create_snippet_editor:function($snippet){if(typeof $snippet.data("snippet-editor")==='undefined'){if(!this.activate_overlay_zones($snippet).length)return;$snippet.data("snippet-editor",new Editor(this,$snippet));}},make_snippet_draggable:function($snippets){var self=this;var $tumb=$snippets.find(".oe_snippet_thumbnail_img:first");var left=$tumb.outerWidth()/2;var top=$tumb.outerHeight()/2;var $toInsert,dropped,$snippet,action,snipped_id;$snippets.draggable({greedy:true,helper:'clone',zIndex:'1000',appendTo:'body',cursor:"move",handle:".oe_snippet_thumbnail",cursorAt:{'left':left,'top':top},start:function(){self.hide();dropped=false;$snippet=$(this);var $base_body=$snippet.find('.oe_snippet_body');var $selector_siblings=$();var $selector_children=$();var vertical=false;var temp=self.templateOptions;for(var k in temp){if($base_body.is(temp[k].base_selector)){if(temp[k]['drop-near']){if(!$selector_siblings)$selector_siblings=temp[k]['drop-near'].all();else $selector_siblings=$selector_siblings.add(temp[k]['drop-near'].all());}
if(temp[k]['drop-in']){if(!$selector_children)$selector_children=temp[k]['drop-in'].all();else $selector_children=$selector_children.add(temp[k]['drop-in'].all());}}}
$toInsert=$base_body.clone();if(!$selector_siblings.length&&!$selector_children.length){console.debug($snippet.find(".oe_snippet_thumbnail_title").text()+" have not insert action: data-drop-near or data-drop-in");return;}
self.activate_insertion_zones($selector_siblings,$selector_children);$('.oe_drop_zone').droppable({over:function(){dropped=true;$(this).first().after($toInsert);},out:function(){var prev=$toInsert.prev();if(this===prev[0]){dropped=false;$toInsert.detach();}}});},stop:function(ev,ui){$toInsert.removeClass('oe_snippet_body');if(!dropped&&self.$editable.find('.oe_drop_zone')&&ui.position.top>3){var el=self.$editable.find('.oe_drop_zone').nearest({x:ui.position.left,y:ui.position.top}).first();if(el.length){el.after($toInsert);dropped=true;}}
self.$editable.find('.oe_drop_zone').droppable('destroy').remove();if(dropped){var prev=$toInsert.first()[0].previousSibling;var next=$toInsert.last()[0].nextSibling;var rte=self.parent.rte;if(prev){$toInsert.detach();rte.historyRecordUndo($(prev));$toInsert.insertAfter(prev);}else if(next){$toInsert.detach();rte.historyRecordUndo($(next));$toInsert.insertBefore(next);}else{var $parent=$toInsert.parent();$toInsert.detach();rte.historyRecordUndo($parent);$parent.prepend($toInsert);}
$toInsert.closest(".o_editable").trigger("content_changed");var $target=false;$target=$toInsert;setTimeout(function(){self.$snippet.trigger('snippet-dropped',$target);animation.start(true,$target);self.call_for_all_snippets($target,function(editor,$snippet){_.defer(function(){editor.drop_and_build_snippet();});});self.create_snippet_editor($target);self.cover_target($target.data('overlay'),$target);$target.closest(".o_editable").trigger("content_changed");self.make_active($target);},0);}else{$toInsert.remove();}},});},call_for_all_snippets:function($snippet,callback){var self=this;$snippet.add(globalSelector.all($snippet)).each(function(){var $snippet=$(this);self.create_snippet_editor($snippet);if($snippet.data("snippet-editor")){callback.call(self,$snippet.data("snippet-editor"),$snippet);}});},get_snippet_from_id:function(id){return $('.oe_snippet').filter(function(){return $(this).data('option')===id;}).first();},activate_insertion_zones:function($selector_siblings,$selector_children){var self=this;var zone_template=$("<div class='oe_drop_zone oe_insert'></div>");if($selector_children){$selector_children.each(function(){var $zone=$(this);var css=window.getComputedStyle(this);var float=css.float||css.cssFloat;var $drop=zone_template.clone();$zone.append($drop);var node=$drop[0].previousSibling;var test=!!(node&&((!node.tagName&&node.textContent.match(/\S/))||node.tagName==="BR"));if(test){$drop.addClass("oe_vertical oe_vertical_text").css({'height':parseInt(window.getComputedStyle($zone[0]).lineHeight),'float':'none','display':'inline-block'});}else if(float==="left"||float==="right"){$drop.addClass("oe_vertical").css('height',Math.max(Math.min($zone.outerHeight(),$zone.children().last().outerHeight()),30));}
$drop=$drop.clone();$zone.prepend($drop);var node=$drop[0].nextSibling;var test=!!(node&&((!node.tagName&&node.textContent.match(/\S/))||node.tagName==="BR"));if(test){$drop.addClass("oe_vertical oe_vertical_text").css({'height':parseInt(window.getComputedStyle($zone[0]).lineHeight),'float':'none','display':'inline-block'});}else if(float==="left"||float==="right"){$drop.addClass("oe_vertical").css('height',Math.max(Math.min($zone.outerHeight(),$zone.children().first().outerHeight()),30));}
if(test){$drop.css({'float':'none','display':'inline-block'});}});$selector_siblings=$(_.uniq(($selector_siblings||$()).add($selector_children.children()).get()));}
if($selector_siblings){$selector_siblings.filter(':not(.oe_drop_zone):not(.oe_drop_clone)').each(function(){var $zone=$(this);var $drop;var css=window.getComputedStyle(this);var float=css.float||css.cssFloat;if($zone.prev('.oe_drop_zone:visible').length===0){$drop=zone_template.clone();if(float==="left"||float==="right"){$drop.addClass("oe_vertical").css('height',Math.max(Math.min($zone.outerHeight(),$zone.prev().outerHeight()||Infinity),30));}
$zone.before($drop);}
if($zone.next('.oe_drop_zone:visible').length===0){$drop=zone_template.clone();if(float==="left"||float==="right"){$drop.addClass("oe_vertical").css('height',Math.max(Math.min($zone.outerHeight(),$zone.next().outerHeight()||Infinity),30));}
$zone.after($drop);}});}
var count;do{count=0;$zones=self.$editable.find('.oe_drop_zone > .oe_drop_zone').remove();count+=$zones.length;$zones.remove();}while(count>0);var $zones=self.$editable.find('.oe_drop_zone:not(.oe_vertical)');$zones.each(function(){var zone=$(this);var prev=zone.prev();var next=zone.next();if(prev.is('.oe_drop_zone')||next.is('.oe_drop_zone')){zone.remove();return;}
var float_prev=prev.css('float')||'none';var float_next=next.css('float')||'none';var disp_prev=prev.css('display')||null;var disp_next=next.css('display')||null;if((float_prev==='left'||float_prev==='right')&&(float_next==='left'||float_next==='right')){zone.remove();}else if(!(disp_prev===null||disp_next===null||disp_prev==='block'||disp_next==='block')){zone.remove();}});},activate_overlay_zones:function($targets){var self=this;function is_visible($el){return $el.css('display')!='none'&&$el.css('opacity')!='0'&&$el.css('visibility')!='hidden';}
$targets=$targets.filter(function(){return is_visible($(this));});$targets=$targets.filter(function(){var parents=$(this).parents().filter(function(){return!is_visible($(this));});return parents.length===0;});$targets.each(function(){var $target=$(this);if(!$target.data('overlay')){var $zone=$(qweb.render('web_editor.snippet_overlay'));if(document.body&&document.body.addEventListener){$zone.on("click mousedown mousedown",function passThrough(event){event.preventDefault();$target.each(function(){event.srcElement=this;$(this).trigger(event.type);});return false;});}
$zone.appendTo('#oe_manipulators');$zone.data('target',$target);$target.data('overlay',$zone);var timer;$target.closest('.o_editable').on("content_changed",function(event){clearTimeout(timer);timer=setTimeout(function(){if($target.data('overlay')&&$target.data('overlay').hasClass("oe_active")){self.cover_target($target.data('overlay'),$target);}},50);});var resize=function(){if($zone.parent().length){self.cover_target($zone,$target);}else{$('body').off("resize",resize);}};$('body').on("resize",resize);}
self.cover_target($target.data('overlay'),$target);});return $targets;}});var Editor=Class.extend({init:function(BuildingBlock,dom){this.buildingBlock=BuildingBlock;this.$target=$(dom);this.$overlay=this.$target.data('overlay');this.load_style_options();this.get_parent_block();this.start();},_drag_and_drop:function(){var self=this;this.dropped=false;this.$overlay.draggable({greedy:true,appendTo:'body',cursor:"move",handle:".oe_snippet_move",cursorAt:{left:18,top:14},helper:function(){var $clone=$(this).clone().css({width:"24px",height:"24px",border:0});$clone.find(".oe_overlay_options >:not(:contains(.oe_snippet_move)), .oe_handle").remove();$clone.find(":not(.glyphicon)").css({position:'absolute',top:0,left:0});$clone.appendTo("body").removeClass("hidden");return $clone;},start:_.bind(self._drag_and_drop_start,self),stop:_.bind(self._drag_and_drop_stop,self)});},_drag_and_drop_after_insert_dropzone:function(){},_drag_and_drop_active_drop_zone:function($zones){var self=this;$zones.droppable({over:function(){$(".oe_drop_zone.hide").removeClass("hide");$(this).addClass("hide").first().after(self.$target);self.dropped=true;},out:function(){$(this).removeClass("hide");self.$target.detach();self.dropped=false;},});},_drag_and_drop_start:function(){var self=this;self.buildingBlock.hide();self.buildingBlock.editor_busy=true;self.size={width:self.$target.width(),height:self.$target.height()};self.$target.after("<div class='oe_drop_clone' style='display: none;'/>");self.$target.detach();self.$overlay.addClass("hidden");var $selector_siblings;for(var i=0;i<self.selector_siblings.length;i++){if(!$selector_siblings)$selector_siblings=self.selector_siblings[i].all();else $selector_siblings=$selector_siblings.add(self.selector_siblings[i].all());}
var $selector_children;for(var i=0;i<self.selector_children.length;i++){if(!$selector_children)$selector_children=self.selector_children[i].all();else $selector_children=$selector_children.add(self.selector_children[i].all());}
self.buildingBlock.activate_insertion_zones($selector_siblings,$selector_children);$("body").addClass('move-important');self._drag_and_drop_after_insert_dropzone();self._drag_and_drop_active_drop_zone($('.oe_drop_zone'));},_drag_and_drop_stop:function(){var self=this;$(".oe_drop_zone").droppable('destroy').remove();var prev=this.$target.first()[0].previousSibling;var next=this.$target.last()[0].nextSibling;var $parent=this.$target.parent();var $clone=$(".oe_drop_clone");if(prev===$clone[0]){prev=$clone[0].previousSibling;}else if(next===$clone[0]){next=$clone[0].nextSibling;}
$clone.after(this.$target);this.$overlay.removeClass("hidden");$("body").removeClass('move-important');$clone.remove();$(".oe_drop_to_remove").remove();if(this.dropped){this.buildingBlock.parent.rte.historyRecordUndo(this.$target);if(prev){this.$target.insertAfter(prev);}else if(next){this.$target.insertBefore(next);}else{$parent.prepend(this.$target);}
for(var i in this.styles){this.styles[i].on_move();}}
self.buildingBlock.editor_busy=false;self.get_parent_block();setTimeout(function(){self.buildingBlock.cover_target(self.$target.data('overlay'),self.$target);},0);},load_style_options:function(){var self=this;var $styles=this.$overlay.find('.oe_options');var $ul=$styles.find('ul:first');this.styles={};this.selector_siblings=[];this.selector_children=[];_.each(this.buildingBlock.templateOptions,function(val,option_id){if(!val.selector.is(self.$target)){return;}
if(val['drop-near'])self.selector_siblings.push(val['drop-near']);if(val['drop-in'])self.selector_children.push(val['drop-in']);var option=val['option'];var Editor=options.registry[option]||options.Class;var editor=self.styles[option]=new Editor(self.buildingBlock,self,self.$target,option_id);$ul.append(editor.$el.addClass("snippet-option-"+option));editor.start();});if(!this.selector_siblings.length&&!this.selector_children.length){this.$overlay.find(".oe_snippet_move, .oe_snippet_clone, .oe_snippet_remove").addClass('hidden');}
if($ul.find("li").length){$styles.removeClass("hidden");}
this.$overlay.find('[data-toggle="dropdown"]').dropdown();},get_parent_block:function(){var self=this;var $button=this.$overlay.find('.oe_snippet_parent');var $parent=this.$target.parents().filter(function(){return $(this).data("snippet-editor");});if(!$parent.length){$parent=globalSelector.closest(this.$target.parent());}
if($parent.length){$button.removeClass("hidden");$button.off("click").on('click',function(event){event.preventDefault();setTimeout(function(){self.buildingBlock.make_active($parent);},0);});}else{$button.addClass("hidden");}},start:function(){var self=this;if(!this.$target.parent().is(':o_editable')){this.$overlay.find('.oe_snippet_move, .oe_snippet_clone, .oe_snippet_remove').remove();}else{this.$overlay.on('click','.oe_snippet_clone',_.bind(this.on_clone,this));this.$overlay.on('click','.oe_snippet_remove',_.bind(this.on_remove,this));this._drag_and_drop();}},on_clone:function(event){event.preventDefault();var $clone=this.$target.clone(false);this.buildingBlock.parent.rte.historyRecordUndo(this.$target);this.$target.after($clone);this.buildingBlock.call_for_all_snippets($clone,function(editor,$snippet){for(var i in editor.styles){editor.styles[i].on_clone($snippet);}});return false;},on_remove:function(event){event.preventDefault();this.on_blur();this.buildingBlock.parent.rte.historyRecordUndo(this.$target);var index=_.indexOf(this.buildingBlock.snippets,this.$target.get(0));this.buildingBlock.call_for_all_snippets(this.$target,function(editor,$snippet){for(var i in editor.styles){editor.styles[i].on_remove();}});delete this.buildingBlock.snippets[index];var $editable=this.$target.closest(".o_editable");var node=this.$target.parent()[0];this.$target.remove();this.$overlay.remove();if(node&&node.firstChild){$.summernote.core.dom.removeSpace(node,node.firstChild,0,node.lastChild,1);if(!node.firstChild.tagName&&node.firstChild.textContent===" "){node.firstChild.parentNode.removeChild(node.firstChild);}}
$(".note-control-selection").hide();$('.o_table_handler').remove();return false;},drop_and_build_snippet:function(){for(var i in this.styles){this.styles[i].drop_and_build_snippet();}},on_focus:function(){this.$overlay.addClass('oe_active');for(var i in this.styles){this.styles[i].on_focus();}},on_blur:function(){for(var i in this.styles){this.styles[i].on_blur();}
this.$overlay.removeClass('oe_active');},});var data={Class:BuildingBlock,Editor:Editor,globalSelector:globalSelector,};return data;});;

/* /web_editor/static/src/js/snippets.options.js defined in bundle 'web_editor.editor' */
odoo.define('web_editor.snippets.options',function(require){'use strict';var Class=require('web.Class');var ajax=require('web.ajax');var core=require('web.core');var base=require('web_editor.base');var editor=require('web_editor.editor');var widget=require('web_editor.widget');var animation=require('web_editor.snippets.animation');var qweb=core.qweb;var Option=Class.extend({init:function(BuildingBlock,editor,$target,option_id){this.buildingBlock=BuildingBlock;this.editor=editor;this.$target=$target;var option=this.buildingBlock.templateOptions[option_id];var styles=this.$target.data("snippet-option-ids")||{};styles[option_id]=this;this.$target.data("snippet-option-ids",styles);this.$overlay=this.$target.data('overlay')||$('<div>');this.option=option_id;this.$el=option.$el.find(">li").clone();this.data=option.$el.data();},$:function(selector){return this.$target.find(selector);},_bind_li_menu:function(){this.$el.filter("li:hasData").find('a:first').off('mouseenter click').on('mouseenter click',_.bind(this._mouse,this));this.$el.off('mouseenter click',"li:hasData a").on('mouseenter click',"li:hasData a",_.bind(this._mouse,this));this.$el.closest("ul").add(this.$el).off('mouseleave').on('mouseleave',_.bind(this.reset,this));this.$el.off('mouseleave',"ul").on('mouseleave',"ul",_.bind(this.reset,this));this.reset_methods=[];},_time_mouseleave:null,_mouse:function(event){var $next=$(event.currentTarget).parent();this.select(event.type==="click"?"click":"over",$next);if(event.type==='click'){this.set_active();this.$target.trigger("snippet-option-change",[this]);}else{this.$target.trigger("snippet-option-preview",[this]);}},set_active:function(){var classes=_.uniq((this.$target.attr("class")||'').split(/\s+/));this.$el.find('[data-toggle_class], [data-select_class]').add(this.$el).filter('[data-toggle_class], [data-select_class]').removeClass("active").filter('[data-toggle_class="'+classes.join('"], [data-toggle_class="')+'"] ,'+'[data-select_class="'+classes.join('"], [data-select_class="')+'"]').addClass("active");},start:function(){this.set_active();this.$target.on('snippet-option-reset',_.bind(this.set_active,this));this._bind_li_menu();},on_focus:function(){this._bind_li_menu();},on_blur:function(){},on_clone:function($clone){},on_move:function(){},on_remove:function(){},drop_and_build_snippet:function(){},reset:function(){var self=this;var lis=self.$el.add(self.$el.find('li')).filter('.active').get();lis.reverse();_.each(lis,function(li){var $li=$(li);for(var k in self.reset_methods){var method=self.reset_methods[k];if($li.is('[data-'+method+']')||$li.closest('[data-'+method+']').size()){delete self.reset_methods[k];}}
self.select("reset",$li);});for(var k in self.reset_methods){var method=self.reset_methods[k];if(method){self[method]("reset",null);}}
self.reset_methods=[];self.$target.trigger("snippet-option-reset",[this]);},select:function(type,$li){var self=this,$methods=[],el=$li[0];if($li.data('only')&&type!==$li.data('only')){return;}
if(type==="click"){this.reset();this.buildingBlock.parent.rte.historyRecordUndo(this.$target);}
function filter(k){return k!=='oeId'&&k!=='oeModel'&&k!=='oeField'&&k!=='oeXpath'&&k!=='oeSourceId'&&k!=='only';}
function hasData(el){for(var k in el.dataset){if(filter(k)){return true;}}
return false;}
function method(el){var data={};for(var k in el.dataset){if(filter(k)){data[k]=el.dataset[k];}}
return data;}
while(el&&this.$el.is(el)||_.some(this.$el.map(function(){return $.contains(this,el);}).get())){if(hasData(el)){$methods.push(el);}
el=el.parentNode;}
$methods.reverse();_.each($methods,function(el){var $el=$(el);var methods=method(el);for(var k in methods){if(self[k]){if(type!=="reset"&&self.reset_methods.indexOf(k)===-1){self.reset_methods.push(k);}
self[k](type,methods[k],$el);}else{console.error("'"+self.option+"' snippet have not method '"+k+"'");}}});},toggle_class:function(type,value,$li){var $lis=this.$el.find('[data-toggle_class]').add(this.$el).filter('[data-toggle_class]');function map($lis){return $lis.map(function(){return $(this).data("toggle_class");}).get().join(" ");}
var classes=map($lis);var active_classes=map($lis.filter('.active, :has(.active)'));this.$target.removeClass(classes);this.$target.addClass(active_classes);if(type!=='reset'){this.$target.toggleClass(value);}},select_class:function(type,value,$li){var $lis=this.$el.find('[data-select_class]').add(this.$el).filter('[data-select_class]');var classes=$lis.map(function(){return $(this).data('select_class');}).get();this.$target.removeClass(classes.join(" "));if(value)this.$target.addClass(value);},eval:function(type,value,$li){var fn=new Function("node","type","value","$li",value);fn.call(this,this,type,value,$li);},clean_for_save:editor.dummy});var media=Option.extend({start:function(){var self=this;this._super();animation.start(true,this.$target);this.$target.closest(".o_editable").on("content_changed",function(){if(!self.$target.parent().length){self.$target.remove();self.$overlay.remove();}});},edition:function(type,value){if(type!=="click")return;var self=this;var _editor=new widget.MediaDialog(this.$target.closest('.o_editable'),this.$target[0]);_editor.appendTo(document.body);_editor.on('saved',this,function(item,old){self.editor.on_blur();self.buildingBlock.make_active(false);if(self.$target.parent().data("oe-field")!=="image"){setTimeout(function(){self.buildingBlock.make_active($(item));},0);}
$(item).trigger("content_changed");});},on_focus:function(){var self=this;var $parent=this.$target.parent();if($parent.data("oe-field")==="image"&&$parent.hasClass('o_editable')){this.$overlay.addClass("hidden");self.edition('click',null);self.buildingBlock.make_active(false);}}});var colorpicker=Option.extend({start:function(){var self=this;var res=this._super();if(!this.$el.find('.colorpicker').length){this.$el.find('li').append(qweb.render('web_editor.colorpicker'));}
if(this.$el.data('area')){this.$target=this.$target.find(this.$el.data('area'));this.$el.removeData('area').removeAttr('area');}
var classes=[];this.$el.find(".colorpicker button").map(function(){var $color=$(this);var color=$color.attr("class");if(self.$target.hasClass(color)){self.color=color;$color.parent().addClass("selected");}
classes.push(color);});this.classes=classes.join(" ");this.bind_events();return res;},bind_events:function(){var self=this;var $td=this.$el.find(".colorpicker td");var $colors=this.$el.find(".colorpicker button");$colors.mouseenter(function(){self.$target.removeClass(self.classes).addClass($(this).attr("class"));}).mouseleave(function(){self.$target.removeClass(self.classes).addClass($td.filter(".selected").children().attr("class"));}).click(function(){$td.removeClass("selected");$(this).parent().addClass("selected");self.$target.closest(".o_editable").trigger("content_changed");});}});var background=Option.extend({start:function($change_target){this.$target=$change_target||this.$target;this._super();var src=this.$target.css("background-image").replace(/url\(['"]*|['"]*\)|^none$/g,"");if(this.$target.hasClass('oe_custom_bg')){this.$el.find('li[data-choose_image]').data("background",src).attr("data-background",src);}},background:function(type,value,$li){if(value&&value.length){this.$target.attr("style",'background-image: url('+value+'); '+(this.$target.attr("style")||'').replace(/background-image:[^;]+/,''));this.$target.addClass("oe_img_bg");}else{this.$target.css("background-image","");this.$target.removeClass("oe_img_bg").removeClass("oe_custom_bg");}},select_class:function(type,value,$li){this.background(type,'',$li);this._super(type,value,$li);},choose_image:function(type,value,$li){if(type!=="click")return;var self=this;var $image=$('<img class="hidden"/>');$image.attr("src",value);$image.appendTo(self.$target);var _editor=new widget.MediaDialog(null,$image[0]);_editor.appendTo(document.body);_editor.$('[href="#editor-media-video"], [href="#editor-media-icon"]').addClass('hidden');_editor.on('saved',self,function(){var value=$image.attr("src");$image.remove();self.$el.find('li[data-choose_image]').data("background",value).attr("data-background",value);self.background(type,value,$li);self.$target.addClass('oe_custom_bg');self.$target.trigger("snippet-option-change",[self]);self.set_active();});_editor.on('cancel',self,function(){$image.remove();});},set_active:function(){var self=this;var src=this.$target.css("background-image").replace(/url\(['"]*|['"]*\)|^none$/g,"");this._super();if(this.$target.hasClass('oe_custom_bg')){this.$el.find('li[data-choose_image]').data("background",src).attr("data-background",src);}
this.$el.find('li[data-background]:not([data-background=""])').removeClass("active").each(function(){var background=$(this).data("background")||$(this).attr("data-background");if((src.length&&background.length&&src.indexOf(background)!==-1)||(!src.length&&!background.length)){$(this).addClass("active");}});if(!this.$el.find('li[data-background].active').size()){this.$el.find('li[data-background=""]:not([data-choose_image])').addClass("active");}else{this.$el.find('li[data-background=""]:not([data-choose_image])').removeClass("active");}}});var many2one=Option.extend({start:function(){var self=this;this.Model=this.$target.data('oe-many2one-model');this.ID=+this.$target.data('oe-many2one-id');this.$btn=$(qweb.render("web_editor.many2one.button")).insertAfter(this.$overlay.find('.oe_options'));this.$ul=this.$btn.find("ul");this.$search=this.$ul.find('li:first');this.$search.find('input').on('mousedown click mouseup keyup keydown',function(e){e.stopPropagation();});setTimeout(function(){if(self.$overlay.find('.oe_options').hasClass('hidden')){self.$btn.css('height','0').find('> a').addClass('hidden');self.$ul.show().css({'top':'-24px','margin':'0','padding':'2px 0','position':'relative'});}else{self.$btn.find('a').on('click',function(e){self.clear();});}},0);this.$search.find('input').focus().on('keyup',function(e){self.find_existing($(this).val());});this.$ul.on('click',"li:not(:first) a",function(e){self.select_record(this);});},on_focus:function(){this.$target.attr('contentEditable','false');this.clear();this._super();},clear:function(){var self=this;this.$search.siblings().remove();self.$search.find('input').val("");setTimeout(function(){self.$search.find('input').focus();},0);},find_existing:function(name){var self=this;var domain=[];if(!name||!name.length){self.$search.siblings().remove();return;}
if(isNaN(+name)){if(this.Model!=="res.partner"){domain.push(['name','ilike',name]);}else{domain.push('|',['name','ilike',name],['email','ilike',name]);}}else{domain.push(['id','=',name]);}
ajax.jsonRpc('/web/dataset/call_kw','call',{model:this.Model,method:'search_read',args:[domain,this.Model==="res.partner"?['name','display_name','city','country_id']:['name','display_name']],kwargs:{order:'name DESC',limit:5,context:base.get_context(),}}).then(function(result){self.$search.siblings().remove();self.$search.after(qweb.render("web_editor.many2one.search",{contacts:result}));});},get_contact_rendering:function(options){return ajax.jsonRpc('/web/dataset/call_kw','call',{model:'ir.qweb.field.contact',method:'get_record_to_html',args:[[this.ID]],kwargs:{options:options,context:base.get_context(),}});},select_record:function(li){var self=this;this.ID=+$(li).data("id");this.$target.attr('data-oe-many2one-id',this.ID).data('oe-many2one-id',this.ID);this.buildingBlock.parent.rte.historyRecordUndo(this.$target);this.$target.trigger('content_changed');if(self.$target.data('oe-type')==="contact"){$('[data-oe-contact-options]').filter('[data-oe-model="'+self.$target.data('oe-model')+'"]').filter('[data-oe-id="'+self.$target.data('oe-id')+'"]').filter('[data-oe-field="'+self.$target.data('oe-field')+'"]').filter('[data-oe-contact-options!="'+self.$target.data('oe-contact-options')+'"]').add(self.$target).attr('data-oe-many2one-id',self.ID).data('oe-many2one-id',self.ID).each(function(){var $node=$(this);self.get_contact_rendering($node.data('oe-contact-options')).then(function(html){$node.html(html);});});}else{self.$target.html($(li).data("name"));}
setTimeout(function(){self.buildingBlock.make_active(false);},0);}});return{'registry':{'media':media,'colorpicker':colorpicker,'background':background,'many2one':many2one,},'Class':Option};});;

/* /web_editor/static/src/js/tour.rte.js defined in bundle 'web_editor.editor' */
odoo.define('web_editor.tour',function(require){'use strict';var core=require('web.core');var Tour=require('web.Tour');var base=require('web_editor.base');var snippet_editor=require('web_editor.snippet.editor');var _t=core._t;base.ready().done(function(){var click_event=function(el,type){var evt=document.createEvent("MouseEvents");evt.initMouseEvent(type,true,true,window,0,0,0,0,0,false,false,false,false,0,el);el.dispatchEvent(evt);};Tour.register({id:'rte',name:"Test RTE",mode:'test',path:'/web_editor/field/html?debug&callback=FieldTextHtml_0&enable_editor=1&datarecord=%7B%7D',steps:[{title:"Change html for this test",onload:function(){var html='\n'+'<section>\n'+'    <div class="container">\n'+'        <div class="row">\n'+'            <div class="col-md-6 mt16">\n'+'<h1 id="text_title_id">Batnae municipium in Anthemusia</h1>     \n'+'     <p>Batnae municipium in Anthemusia conditum Macedonum manu priscorum ab Euphrate flumine brevi spatio disparatur, refertum mercatoribus opulentis, ubi annua sollemnitate prope Septembris initium mensis ad.</p>\n'+'     <p>    Quam <img style="width: 25%" src="/web_editor/static/src/img/drag_here.png"/> quidem <span class="fa fa-flag fa-2x"></span> partem accusationis admiratus sum et moleste tuli potissimum esse Atratino datam. Neque enim decebat neque aetas.</p>\n'+'     <p>Et hanc quidem praeter oppida multa duae civitates exornant Seleucia opus Seleuci regis, et Claudiopolis quam deduxit coloniam Claudius Caesar. Isaura enim antehac nimium potens, olim subversa ut rebellatrix.</p>'+'<p>Harum trium sententiarum nulli prorsus assentior.</p>\n'+'        </div>\n'+'        <div class="col-md-6 mt16">\n'+'            <img class="img img-responsive shadow mb16" src="/web_editor/static/src/img/drag_here.png" alt="Odoo text and image block">\n'+'        </div>\n'+'    </div>\n'+'</section>\n';$("#editable_area").html(html);}},{element:'#editable_area > section .row > div:first',title:"simulate triple click and change text bg-color",onload:function(){var $el=$(this.element);var $h1=$('h1',$el);$.summernote.core.range.create($h1[0].firstChild,0,$('p',$el)[0],0).select();click_event($h1[0],'mouseup');}},{waitFor:'#editable_area > section .row > div:first',element:'.note-popover button[data-event="color"]:visible',title:"change text bg-color after triple click",},{waitFor:'#editable_area > section .row > div:first:not(:has(p font)) h1 font',element:'.note-color button.dropdown-toggle:visible',title:"change selection to change text color",onload:function(){var $el=$('#editable_area > section .row > div:first:not(:has(p font)) h1 font');$.summernote.core.range.create($el[0].firstChild,5,$el[0].firstChild,10).select();click_event($el[0],'mouseup');}},{element:'div[data-target-event="foreColor"]:visible .note-color-row:eq(1) button[data-event="foreColor"]:first',title:"change text color",},{waitFor:'#editable_area > section .row > div:first h1 font:eq(2)',element:'.note-color button.dropdown-toggle:visible',title:"change selection to change text bg-color again",onload:function(){var $el=$('#editable_area > section .row > div:first h1 font:eq(2)');$.summernote.core.range.create($el.prev()[0].firstChild,3,$el[0].firstChild,10).select();click_event($el.prev()[0],'mouseup');}},{element:'div[data-target-event="backColor"] .colorpicker button[data-event="backColor"]:first',title:"change text backColor again",},{waitFor:'#editable_area > section .row > div:first h1 font:eq(4)',element:'.note-color button.dropdown-toggle:visible',title:"change selection (h1 and p) to change text color with class",onload:function(){var $el=$('#editable_area > section .row > div:first h1 font:eq(4)');$.summernote.core.range.create($el.prev()[0].firstChild,3,$el.parent("h1").next("p")[0].firstChild,30).select();click_event($el.prev()[0],'mouseup');}},{element:'div[data-target-event="foreColor"]:visible button[data-event="foreColor"][data-value^="text-"]:first',title:"change text foreColor again",},{waitFor:'#editable_area > section .row > div:first p font',element:'.o_editable.note-editable.o_dirty',title:"delete selection",keydown:46},{waitFor:'#editable_area > section .row > div:first:not(:has(p font)) h1',element:'.o_editable.note-editable.o_dirty',title:"clean and delete (backspace) an other selection",onload:function(){var $el=$(this.waitFor);$.summernote.core.range.createFromNode($el.next("p")[0]).clean();$.summernote.core.range.create($el.find('font:containsExact(ici)')[0].firstChild,1,$el.next().next()[0].firstChild,5).select();click_event($el.find('font:last')[0],'mouseup');},keydown:8},{waitFor:'#editable_area > section .row > div:first:has( font:last:containsExact(i) ):has( p:first:containsRegex(/^uam/) ) h1',element:'.o_editable.note-editable.o_dirty',title:"delete an other selection",onload:function(){var $el=$(this.waitFor);$.summernote.core.range.create($el.find('font:first')[0].firstChild,3,$el.next("p")[0].childNodes[2],8).select();click_event($el.find('font:first')[0],'mouseup');},keydown:46},{waitFor:'#editable_area > section .row > div:first:has( font:last:containsExact(Bat) )',element:'.note-image-popover button[data-event="undo"]',title:"undo",},{waitFor:'#editable_area > section .row > div:first:has( font:last:containsExact(i) )',element:'.note-air-popover button[data-event="undo"]',title:"undo again",},{waitFor:'#editable_area > section .row > div:first:not(:has(p font)) h1',element:'.o_editable.note-editable.o_dirty',title:"delete (backspace) after undo",keydown:8},{waitFor:'#editable_area > section .row > div:first:has( font:last:containsExact(i) ):has( p:first:containsRegex(/^uam/) )',element:'#editable_area > section .row > div:first img[style*="25%"]',title:"click on image",},{element:'.note-image-popover:visible button[data-event="resize"][data-value="0.5"]',title:"Click on resize half",},{waitFor:'#editable_area > section .row > div:first img[style*="50%"]',element:'.note-image-popover:visible button[data-event="showImageDialog"]',title:"Click on edit picture",},{waitFor:'.modal #editor-media-image',element:'.modal a[data-toggle="tab"]:contains(Pictogram)',title:"Click on pictogram tab",},{element:'#editor-media-icon.active span.fa:first',title:"select a pictogram",},{waitFor:'#editor-media-icon.active span.font-icons-selected',element:'.modal button.save',title:"save pictogram",},{element:'.note-image-popover button[data-event="resizefa"][data-value="3"]',title:"select a size for the pictogram",},{waitFor:'#wrapwrap span.fa-3x',element:'.note-image-popover:visible button[data-event="floatMe"][data-value="right"]',title:"click on float right",},{waitFor:'#editable_area > section .row > div:first span.fa.pull-right',element:'.note-image-popover:visible button[data-event="showLinkDialog"]',title:"click on create link",},{waitFor:'.modal a#link-preview:containsRegex(/^<span [^>]+><\\/span>$/) > span.fa.fa-3x.pull-right',element:'.modal .dropdown:has(.link-style) a[data-toggle="dropdown"]',title:"click on color style",},{element:'.modal .dropdown ul label.btn-success',title:"choose success style",},{element:'#link-text',title:"change text label",sampleText:"ABC[IMG] DEF",},{waitFor:'.modal a#link-preview.btn',element:'#link-external',sampleText:"http://www.odoo.com",title:"insert a link url",},{waitFor:'.modal a#link-preview.btn:containsRegex(/^ABC<span [^>]+><\\/span> DEF$/)',element:'.modal button.save',title:"save link",},{waitNot:'#link-preview',waitFor:'a.btn[href^="http://"]:has(span.fa.fa-3x.pull-right)',element:'#editable_area > section .row > div:last img',title:"click on other picture",},{waitFor:'#editable_area > section .row > div:first span.fa.pull-right',element:'.note-image-popover:visible button[data-event="showLinkDialog"]',title:"click on create link again",},{waitFor:'.modal a#link-preview:containsRegex(/^<img [^>]+>$/)',element:'.modal .dropdown:has(.link-style) a[data-toggle="dropdown"]',title:"click on color style again",},{element:'.modal .dropdown ul label.btn-success',title:"choose success style",},{waitFor:'.modal a#link-preview.btn',element:'#link-external',sampleText:"test@test.test",title:"insert an email",},{waitFor:'.modal a#link-preview.btn[href="mailto:test@test.test"]',element:'.modal button.save',title:"save link",},{waitNot:'#link-preview',waitFor:'#editable_area > section .row > div:eq(1) > a > img',element:'#editable_area > section .row > div:first p:eq(2)',title:"triple enter then double backspace",keydown:[66,13,66,13,13,8,8],onload:function(){var p=$(this.element)[0].firstChild;$.summernote.core.range.create(p,p.textContent.length,p,p.textContent.length).select();click_event(p,'mouseup');},},{waitNot:'#editable_area > section .row > div:first p:eq(4), #editable_area > section .row > div:eq(3)',waitFor:'#editable_area > section .row > div:first p:eq(3)',title:"add ul content",onload:function(){var $el=$('#editable_area > section .row > div:first');var html='  <ul>     '+'\n     <li>   <p>Batnae municipium.  </p></li>'+'\n     <li>    Seleucia praeter.</li>'+'\n     <li><p>Et hanc quidem.</p></li>'+'\n    </ul>';$el.append(html);var node=$el.find('ul li p:last')[0].firstChild;$.summernote.core.range.create(node,6).select();click_event(node,'mouseup');}},{waitFor:'#editable_area > section .row > div:first ul li p:first',element:'.note-air-popover .note-style button.dropdown-toggle',title:"click on style dropdown",},{element:'.note-air-popover .note-style ul:visible a[data-value="h3"]',title:"select h3",onload:function(){var node=$('#editable_area > section .row > div:first ul li p:last')[0].firstChild;$.summernote.core.range.create(node,0).select();click_event(node,'mouseup');}},{element:'#editable_area > section .row > div:first > ul > li > h3',title:"double tabulation",keydown:[9,9]},{waitFor:'#editable_area > section .row > div:first ul > li > ul > li > ul > li > h3',element:'.note-air-popover button[data-event="insertOrderedList"]',title:"click on order list",},{waitFor:'#editable_area > section .row > div:first ul > li > ul > li > ol > li > h3',element:'#editable_area > section .row > div:first ul li > p:last',title:"enter in ul",keydown:[66,13],onload:function(){$(this.element)[0].firstChild.textContent+="";$.summernote.core.range.create($(this.element)[0].firstChild,7).select();click_event($(this.element)[0],'mouseup');}},{element:'#editable_area > section .row > div:first ul li > p:eq(1):containsRegex(/^municipium./)',title:"backspace in list",keydown:8},{waitFor:'#editable_area > section .row > div:first ul li p:eq(1)',title:"end",},]});Tour.register({id:'rte_inline',name:"Test RTE Inline",mode:'test',path:'/web_editor/field/html/inline?callback=FieldTextHtml_0&enable_editor=1&datarecord=%7B%7D',steps:[{title:"Change html for this test",onload:function(){var $el=$(this.element);var html='\n'+'<div>\n'+'  <table cellspacing="0" cellpadding="0" width="100%">\n'+'    <tbody>\n'+'      <tr>\n'+'        <td valign="center" width="270">\n'+'          <img src="/logo.png" alt="Your Logo" class="img-circle img-thumbnail">\n'+'        </td>\n'+'        <td valign="center" width="270">\n'+'          <a href="https://www.facebook.com/Odoo"><span class="fa fa-facebook-square fa-2x text-primary"></span></a>\n'+'          <span style="color: rgb(255, 0, 0);" class="fa fa-4x fa-google-plus-square pull-right"></span>\n'+'        </td>\n'+'      </tr>\n'+'    </tbody>\n'+'  </table>\n'+'</div>';$("#editable_area").html(html);}},{title:"call clean for save",element:'#wrapwrap table',onload:function(){snippet_editor.instance.clean_for_save();}},{waitFor:'#wrapwrap img:first[width][height][style*="-radius"][style*="1px"][style*="padding"]',title:"check the image style",},{waitFor:'#wrapwrap img:eq(1)[src^="/web_editor/font_to_img/"][src$="/rgb(66,139,202)/32"]',title:"check the font image src",},{waitFor:'#wrapwrap img:eq(1)[height]:not([class*="fa"])',title:"check the font class to css",},{waitFor:'#wrapwrap img:eq(2)[style*="float:right"]',title:"check the second font class to css",},]});Tour.register({id:'rte_backend_inline',name:"Test RTE in backend view",mode:'test',steps:[{title:"Beginning test",},{title:"Click on edit button",element:'.o_form_button_edit, .oe_form_button_edit',},{title:"Add text to inline html field and save",element:'.o_form_button_save, .oe_form_button_save',onload:function(){$('.oe_form_field_html_text .note-editable > p').append('<i>world</i>');},},{title:"Verify saved data after edition then click on edit button",waitFor:'.oe_form_field_html_text p > i:last-child:contains(world)',element:'.o_form_button_edit, .oe_form_button_edit',},{title:"Switch to code view mode",element:'button[data-event="codeview"]',},{title:"Modify code view content and save",element:'.o_form_button_save, .oe_form_button_save',onload:function(){$('.oe_form_field_html_text textarea.note-codable').val(function(_,val){return val.replace('</p>','<u>!</u></p>');});},},{title:"Verify saved data after code view edition",waitFor:'.oe_form_field_html_text p > u:last-child:contains(!)',},]});});});;

/* /web_editor/static/src/js/transcoder.js defined in bundle 'web_editor.editor' */
odoo.define('web_editor.transcoder',function(require){'use strict';var widget=require('web_editor.widget');var cache={};var rulesCache=[];var getMatchedCSSRules=function(a){if(cache[a.tagName+"."+a.className]){return cache[a.tagName+"."+a.className];}
if(!rulesCache.length){var sheets=document.styleSheets;for(var i=sheets.length-1;i>=0;i--){var rules;if(sheets[i].rules){rules=sheets[i].rules;}else{try{rules=sheets[i].cssRules;}catch(e){console.warn("Can't read the css rules of: "+sheets[i].href,e);continue;}
rules=sheets[i].cssRules;}
if(rules){for(var r=rules.length-1;r>=0;r--){var selectorText=rules[r].selectorText;if(selectorText&&rules[r].cssText&&selectorText!=="*"&&selectorText.indexOf(":hover")===-1&&selectorText.indexOf(":before")===-1&&selectorText.indexOf(":after")===-1&&selectorText.indexOf(":active")===-1&&selectorText.indexOf(":link")===-1&&selectorText.indexOf("::")===-1&&selectorText.indexOf("\"")===-1&&selectorText.indexOf("'")===-1){var st=selectorText.split(/\s*,\s*/);for(var k=0;k<st.length;k++){rulesCache.push({'selector':st[k],'style':rules[r].style});}}}}}
rulesCache.reverse();}
var css=[];a.matches=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector;for(var r=0;r<rulesCache.length;r++){if(a.matches(rulesCache[r].selector)){var style=rulesCache[r].style;if(style.parentRule){var style_obj={};for(var k=0,len=style.length;k<len;k++){style_obj[style[k]]=style[style[k].replace(/-(.)/g,function(a,b){return b.toUpperCase();})];if(new RegExp(style[k]+'\s*:[^:;]+!important').test(style.cssText)){style_obj[style[k]]+=' !important';}}
rulesCache[r].style=style=style_obj;}
css.push([rulesCache[r].selector,style]);}}
function specificity(selector){var a=0;selector.replace(/#[a-z0-9_-]+/gi,function(){a++;return"";});var b=0;selector.replace(/(\.[a-z0-9_-]+)|(\[.*?\])/gi,function(){b++;return"";});var c=0;selector.replace(/(\s+|:+)[a-z0-9_-]+/gi,function(a){if(a.indexOf(':not(')===-1)c++;return"";});return a*100+b*10+c;}
css.sort(function(a,b){return specificity(a[0])-specificity(b[0]);});var style={};_.each(css,function(v,k){_.each(v[1],function(v,k){if(v&&_.isString(v)&&k.indexOf('-webkit')===-1&&(!style[k]||style[k].indexOf('important')===-1||v.indexOf('important')!==-1)){style[k]=v;}});});_.each(style,function(v,k){if(v.indexOf('important')!==-1){style[k]=v.slice(0,v.length-11);}});if(style.display==='block'){delete style.display;}
_.each(['margin','padding'],function(p){if(style[p+'-top']||style[p+'-right']||style[p+'-bottom']||style[p+'-left']){if(style[p+'-top']===style[p+'-right']&&style[p+'-top']===style[p+'-bottom']&&style[p+'-top']===style[p+'-left']){style[p]=style[p+'-top'];}
else{style[p]=(style[p+'-top']||0)+' '+(style[p+'-right']||0)+' '+(style[p+'-bottom']||0)+' '+(style[p+'-left']||0);if(style[p].indexOf('inherit')!==-1||style[p].indexOf('initial')!==-1){delete style[p];return;}}
delete style[p+'-top'];delete style[p+'-right'];delete style[p+'-bottom'];delete style[p+'-left'];}});return a.className?cache[a.tagName+"."+a.className]=style:style;};var font_to_img=function($editable){$(".fa",$editable).each(function(){var $font=$(this);var icon,content;_.find(widget.fontIcons,function(font){return _.find(widget.getCssSelectors(font.parser),function(css){if($font.is(css[0].replace(/::?before/g,''))){icon=css[2].split("-").shift();content=css[1].match(/content:\s*['"]?(.)['"]?/)[1];return true;}});});if(content){var color=$font.css("color").replace(/\s/g,'');var src=_.str.sprintf('/web_editor/font_to_img/%s/%s/'+Math.max(1,$font.height()),window.encodeURI(content),window.encodeURI(color));var $img=$("<img/>").attr("src",src).attr("data-class",$font.attr("class")).attr("class",$font.attr("class").replace(new RegExp("(^|\\s+)"+icon+"(-[^\\s]+)?","gi"),'')).attr("style",$font.attr("style")).attr("height",$font.height()).css("height","").css("font-size","");$font.replaceWith($img);}else{$font.remove();}});};var img_to_font=function($editable){$("img[src*='/web_editor/font_to_img/']",$editable).each(function(){var $img=$(this);var $font=$("<span/>").attr("class",$img.data("class")).attr("style",$img.attr("style")).css("height","");$img.replaceWith($font);});};var class_to_style=function($editable){if(!rulesCache.length){getMatchedCSSRules($editable[0]);}
$editable.find('*').each(function(){var $target=$(this);var css=getMatchedCSSRules(this);var style=$target.attr("style")||"";_.each(css,function(v,k){if(!(new RegExp('(^|;)\s*'+k).test(style))){style=k+":"+v+";"+style;}});if(_.isEmpty(style)){$target.removeAttr("style");}else{$target.attr("style",style);}});};var style_to_class=function($editable){getMatchedCSSRules($editable[0]);var $c=$('<span/>').appendTo("body");$editable.find('*').each(function(){var $target=$(this);var css=getMatchedCSSRules(this);var style="";_.each(css,function(v,k){if(!(new RegExp('(^|;)\s*'+k).test(style))){style=k+":"+v+";"+style;}});css=($c.attr("style",style).attr("style")||"").split(/\s*;\s*/);style=$target.attr("style")||"";_.each(css,function(v){style=style.replace(v,'');});style=style.replace(/;+(\s;)*/g,';').replace(/^;/g,'');if(style!==''){$target.attr("style",style);}else{$target.removeAttr("style");}});$c.remove();};return{'font_to_img':font_to_img,'img_to_font':img_to_font,'class_to_style':class_to_style,'style_to_class':style_to_class,};});;

/* /web_editor/static/src/js/translator.js defined in bundle 'web_editor.editor' */
odoo.define('web_editor.translate',function(require){'use strict';var core=require('web.core');var Model=require('web.Model');var ajax=require('web.ajax');var Class=require('web.Class');var Widget=require('web.Widget');var base=require('web_editor.base');var rte=require('web_editor.rte');var editor_widget=require('web_editor.widget');var qweb=core.qweb;var _t=core._t;ajax.loadXML('/web_editor/static/src/xml/translator.xml',qweb);var translatable=!!$('html').data('translatable');var edit_translations=!!$('html').data('edit_translations');$.fn.extend({prependEvent:function(events,selector,data,handler){this.on(events,selector,data,handler);events=events.split(' ');this.each(function(){var el=this;_.each(events,function(event){var handler=$._data(el,'events')[event].pop();$._data(el,'events')[event].unshift(handler);});});return this;}});var RTE_Translate=rte.Class.extend({saveElement:function($el,context){var key=$el.data('oe-translation-id')?'translation:'+$el.data('oe-translation-id'):($el.data('oe-model')?$el.data('oe-model')+":"+$el.data('oe-id')+":"+$el.data('oe-field')+":"+$el.data('oe-type')+":"+$el.data('oe-expression'):false);if(!key||this.__saved[key])return true;this.__saved[key]=true;if($el.data('oe-translation-id')){var translation_content=this.getEscapedElement($el).html();return ajax.jsonRpc('/web/dataset/call','call',{model:'ir.translation',method:'save_html',args:[[+$el.data('oe-translation-id')],translation_content,context||base.get_context()],});}else{var markup=this.getEscapedElement($el).prop('outerHTML');return ajax.jsonRpc('/web/dataset/call','call',{model:'ir.ui.view',method:'save',args:[$el.data('oe-id'),markup,$el.data('oe-xpath')||null,context||base.get_context()],});}},});var Translate_Modal=editor_widget.Dialog.extend({template:'web_editor.translator.attributes',init:function(parent,node){this._super();this.parent=parent;this.$target=$(node);this.translation=$(node).data('translation');},start:function(){var self=this;this._super();var $group=this.$el.find('.form-group');_.each(this.translation,function(node,attr){var $node=$(node);var $label=$('<label class="control-label"></label>').text(attr);var $input=$('<input class="form-control"/>').val($node.html());$input.on('change keyup',function(){var value=$input.val();$node.html(value).trigger('change',node);$node.data('$node').attr($node.data('attribute'),value).trigger('translate');self.parent.rte_changed(node);});$group.append($label).append($input);});}});var Translate=Widget.extend({events:{'click [data-action="save"]':'save_and_reload','click [data-action="cancel"]':'cancel',},template:'web_editor.translator',init:function(parent,$target,lang){this.parent=parent;this.ir_translation=new Model('ir.translation');this.lang=lang||base.get_context().lang;this.setTarget($target);this._super();this.rte=new RTE_Translate(this,this.config);this.rte.on('change',this,this.rte_changed);},start:function(){this._super();this.$('button[data-action=save]').prop('disabled',true);return this.edit();},setTarget:function($target){var $edit=$target.find('[data-oe-translation-id], [data-oe-model][data-oe-id][data-oe-field]');$edit.filter(':has([data-oe-translation-id], [data-oe-model][data-oe-id][data-oe-field])').attr('data-oe-readonly',true);this.$target=$edit.not('[data-oe-readonly]');var attrs=['placeholder','title','alt'];_.each(attrs,function(attr){$target.find('['+attr+'*="data-oe-translation-id="]').filter(':empty, input, select, textarea, img').each(function(){var $node=$(this);var translation=$node.data('translation')||{};var trans=$node.attr(attr);var match=trans.match(/<span [^>]*data-oe-translation-id="([0-9]+)"[^>]*>(.*)<\/span>/);var $trans=$(trans).addClass('hidden o_editable o_editable_translatable_attribute').appendTo('body');$trans.data('$node',$node).data('attribute',attr);translation[attr]=$trans[0];$node.attr(attr,match[2]);var select2=$node.data('select2');if(select2){select2.blur();$node.on('translate',function(){select2.blur();});$node=select2.container.find('input');}
$node.addClass('o_translatable_attribute').data('translation',translation);});});this.$target_attr=$target.find('.o_translatable_attribute');this.$target_attribute=$('.o_editable_translatable_attribute');},find:function(selector){return selector?this.$target.find(selector).addBack().filter(selector):this.$target;},edit:function(){var flag=false;window.onbeforeunload=function(event){if($('.o_editable.o_dirty').length&&!flag){flag=true;setTimeout(function(){flag=false;},0);return _t('This document is not saved!');}};this.$target.addClass("o_editable");this.rte.start();this.translations=[];this.markTranslatableNodes();this.onTranslateReady();},onTranslateReady:function(){this.$el.show();this.trigger("edit");},rte_changed:function(node){var $node=$(node);$node.find("p").each(function(){var $p=$(this);$p.after($p.html()).remove();});var trans=this.getTranlationObject($node[0]);$node.toggleClass('o_dirty',trans.value!==$node.html().replace(/[ \t\n\r]+/,' '));this.$('button[data-action=save]').prop('disabled',!$('.o_editable.o_dirty').length);},getTranlationObject:function(node){var $node=$(node);var id=+$node.data('oe-translation-id');if(!id){id=$node.data('oe-model')+','+$node.data('oe-id')+','+$node.data('oe-field');}
var trans=_.find(this.translations,function(trans){return trans.id===id;});if(!trans){this.translations.push(trans={'id':id});}
return trans;},__unbind_click:function(event){if(event.ctrlKey||!$(event.target).is(':o_editable')){return;}
event.preventDefault();event.stopPropagation();},__translate_attribute:function(event){if(event.ctrlKey){return;}
event.preventDefault();event.stopPropagation();if(event.type!=='mousedown'){return;}
new Translate_Modal(event.data,event.target).appendTo('body');},markTranslatableNodes:function(node){var self=this;this.$target.add(this.$target_attribute).each(function(){var $node=$(this);var trans=self.getTranlationObject(this);trans.value=(trans.value?trans.value:$node.html()).replace(/[ \t\n\r]+/,' ');});this.$target.parent().prependEvent('click',this,this.__unbind_click);this.$target_attr.each(function(){var $node=$(this);var translation=$node.data('translation');_.each(translation,function(node,attr){var trans=self.getTranlationObject(node);trans.value=(trans.value?trans.value:$node.html()).replace(/[ \t\n\r]+/,' ');$node.attr('data-oe-translation-state',(trans.state||'to_translate'));});});this.$target_attr.prependEvent('mousedown click mouseup',this,this.__translate_attribute);console.info('Click on CTRL when you click in an translatable area to have the default behavior');},unarkTranslatableNode:function(){this.$target.removeClass('o_editable').removeAttr('contentEditable');this.$target.parent().off('click',this.__unbind_click);this.$target_attr.off('mousedown click mouseup',this.__translate_attribute);},save_and_reload:function(){return this.save().then(function(){window.location.href=window.location.href.replace(/&?edit_translations(=[^&]*)?/g,'');});},save:function(){var context=base.get_context();context.lang=this.lang;return this.rte.save(context);},cancel:function(){var self=this;this.rte.cancel();this.$target.each(function(){$(this).html(self.getTranlationObject(this).value);});this.unarkTranslatableNode();this.trigger("cancel");this.$el.hide();window.onbeforeunload=null;},destroy:function(){this.cancel();this.$el.remove();this._super();},config:function($editable){if($editable.data('oe-model')){return{'airMode':true,'focus':false,'airPopover':[['history',['undo','redo']],],'styleWithSpan':false,'inlinemedia':['p'],'lang':"odoo",'onChange':function(html,$editable){$editable.trigger("content_changed");}};}
return{'airMode':true,'focus':false,'airPopover':[['font',['bold','italic','underline','clear']],['fontsize',['fontsize']],['color',['color']],['history',['undo','redo']],],'styleWithSpan':false,'inlinemedia':['p'],'lang':"odoo",'onChange':function(html,$editable){$editable.trigger("content_changed");}};}});if(edit_translations){base.ready().then(function(){data.instance=new Translate(this,$('#wrapwrap'));data.instance.prependTo(document.body);$('a[href*=edit_translations]').each(function(){this.href=this.href.replace(/[$?]edit_translations[^&?]+/,'');});$('form[action*=edit_translations]').each(function(){this.action=this.action.replace(/[$?]edit_translations[^&?]+/,'');});$('title').html($('title').html().replace(/&lt;span data-oe-model.+?&gt;(.+?)&lt;\/span&gt;/,'\$1'));});}
var data={'translatable':translatable,'edit_translations':edit_translations,'Class':Translate,};return data;});